{"ast":null,"code":"/*!\n\npica\nhttps://github.com/nodeca/pica\n\n*/\n(function (f) {\n  if (typeof exports === \"object\" && typeof module !== \"undefined\") {\n    module.exports = f();\n  } else if (typeof define === \"function\" && define.amd) {\n    define([], f);\n  } else {\n    var g;\n\n    if (typeof window !== \"undefined\") {\n      g = window;\n    } else if (typeof global !== \"undefined\") {\n      g = global;\n    } else if (typeof self !== \"undefined\") {\n      g = self;\n    } else {\n      g = this;\n    }\n\n    g.pica = f();\n  }\n})(function () {\n  var define, module, exports;\n  return function () {\n    function r(e, n, t) {\n      function o(i, f) {\n        if (!n[i]) {\n          if (!e[i]) {\n            var c = \"function\" == typeof require && require;\n            if (!f && c) return c(i, !0);\n            if (u) return u(i, !0);\n            var a = new Error(\"Cannot find module '\" + i + \"'\");\n            throw a.code = \"MODULE_NOT_FOUND\", a;\n          }\n\n          var p = n[i] = {\n            exports: {}\n          };\n          e[i][0].call(p.exports, function (r) {\n            var n = e[i][1][r];\n            return o(n || r);\n          }, p, p.exports, r, e, n, t);\n        }\n\n        return n[i].exports;\n      }\n\n      for (var u = \"function\" == typeof require && require, i = 0; i < t.length; i++) {\n        o(t[i]);\n      }\n\n      return o;\n    }\n\n    return r;\n  }()({\n    1: [function (_dereq_, module, exports) {\n      // Collection of math functions\n      //\n      // 1. Combine components together\n      // 2. Has async init to load wasm modules\n      //\n      'use strict';\n\n      var inherits = _dereq_('inherits');\n\n      var Multimath = _dereq_('multimath');\n\n      var mm_unsharp_mask = _dereq_('./mm_unsharp_mask');\n\n      var mm_resize = _dereq_('./mm_resize');\n\n      function MathLib(requested_features) {\n        var __requested_features = requested_features || [];\n\n        var features = {\n          js: __requested_features.indexOf('js') >= 0,\n          wasm: __requested_features.indexOf('wasm') >= 0\n        };\n        Multimath.call(this, features);\n        this.features = {\n          js: features.js,\n          wasm: features.wasm && this.has_wasm()\n        };\n        this.use(mm_unsharp_mask);\n        this.use(mm_resize);\n      }\n\n      inherits(MathLib, Multimath);\n\n      MathLib.prototype.resizeAndUnsharp = function resizeAndUnsharp(options, cache) {\n        var result = this.resize(options, cache);\n\n        if (options.unsharpAmount) {\n          this.unsharp_mask(result, options.toWidth, options.toHeight, options.unsharpAmount, options.unsharpRadius, options.unsharpThreshold);\n        }\n\n        return result;\n      };\n\n      module.exports = MathLib;\n    }, {\n      \"./mm_resize\": 4,\n      \"./mm_unsharp_mask\": 9,\n      \"inherits\": 19,\n      \"multimath\": 20\n    }],\n    2: [function (_dereq_, module, exports) {\n      // Resize convolvers, pure JS implementation\n      //\n      'use strict'; // Precision of fixed FP values\n      //var FIXED_FRAC_BITS = 14;\n\n      function clampTo8(i) {\n        return i < 0 ? 0 : i > 255 ? 255 : i;\n      } // Convolve image in horizontal directions and transpose output. In theory,\n      // transpose allow:\n      //\n      // - use the same convolver for both passes (this fails due different\n      //   types of input array and temporary buffer)\n      // - making vertical pass by horisonltal lines inprove CPU cache use.\n      //\n      // But in real life this doesn't work :)\n      //\n\n\n      function convolveHorizontally(src, dest, srcW, srcH, destW, filters) {\n        var r, g, b, a;\n        var filterPtr, filterShift, filterSize;\n        var srcPtr, srcY, destX, filterVal;\n        var srcOffset = 0,\n            destOffset = 0; // For each row\n\n        for (srcY = 0; srcY < srcH; srcY++) {\n          filterPtr = 0; // Apply precomputed filters to each destination row point\n\n          for (destX = 0; destX < destW; destX++) {\n            // Get the filter that determines the current output pixel.\n            filterShift = filters[filterPtr++];\n            filterSize = filters[filterPtr++];\n            srcPtr = srcOffset + filterShift * 4 | 0;\n            r = g = b = a = 0; // Apply the filter to the row to get the destination pixel r, g, b, a\n\n            for (; filterSize > 0; filterSize--) {\n              filterVal = filters[filterPtr++]; // Use reverse order to workaround deopts in old v8 (node v.10)\n              // Big thanks to @mraleph (Vyacheslav Egorov) for the tip.\n\n              a = a + filterVal * src[srcPtr + 3] | 0;\n              b = b + filterVal * src[srcPtr + 2] | 0;\n              g = g + filterVal * src[srcPtr + 1] | 0;\n              r = r + filterVal * src[srcPtr] | 0;\n              srcPtr = srcPtr + 4 | 0;\n            } // Bring this value back in range. All of the filter scaling factors\n            // are in fixed point with FIXED_FRAC_BITS bits of fractional part.\n            //\n            // (!) Add 1/2 of value before clamping to get proper rounding. In other\n            // case brightness loss will be noticeable if you resize image with white\n            // border and place it on white background.\n            //\n\n\n            dest[destOffset + 3] = clampTo8(a + (1 << 13) >> 14\n            /*FIXED_FRAC_BITS*/\n            );\n            dest[destOffset + 2] = clampTo8(b + (1 << 13) >> 14\n            /*FIXED_FRAC_BITS*/\n            );\n            dest[destOffset + 1] = clampTo8(g + (1 << 13) >> 14\n            /*FIXED_FRAC_BITS*/\n            );\n            dest[destOffset] = clampTo8(r + (1 << 13) >> 14\n            /*FIXED_FRAC_BITS*/\n            );\n            destOffset = destOffset + srcH * 4 | 0;\n          }\n\n          destOffset = (srcY + 1) * 4 | 0;\n          srcOffset = (srcY + 1) * srcW * 4 | 0;\n        }\n      } // Technically, convolvers are the same. But input array and temporary\n      // buffer can be of different type (especially, in old browsers). So,\n      // keep code in separate functions to avoid deoptimizations & speed loss.\n\n\n      function convolveVertically(src, dest, srcW, srcH, destW, filters) {\n        var r, g, b, a;\n        var filterPtr, filterShift, filterSize;\n        var srcPtr, srcY, destX, filterVal;\n        var srcOffset = 0,\n            destOffset = 0; // For each row\n\n        for (srcY = 0; srcY < srcH; srcY++) {\n          filterPtr = 0; // Apply precomputed filters to each destination row point\n\n          for (destX = 0; destX < destW; destX++) {\n            // Get the filter that determines the current output pixel.\n            filterShift = filters[filterPtr++];\n            filterSize = filters[filterPtr++];\n            srcPtr = srcOffset + filterShift * 4 | 0;\n            r = g = b = a = 0; // Apply the filter to the row to get the destination pixel r, g, b, a\n\n            for (; filterSize > 0; filterSize--) {\n              filterVal = filters[filterPtr++]; // Use reverse order to workaround deopts in old v8 (node v.10)\n              // Big thanks to @mraleph (Vyacheslav Egorov) for the tip.\n\n              a = a + filterVal * src[srcPtr + 3] | 0;\n              b = b + filterVal * src[srcPtr + 2] | 0;\n              g = g + filterVal * src[srcPtr + 1] | 0;\n              r = r + filterVal * src[srcPtr] | 0;\n              srcPtr = srcPtr + 4 | 0;\n            } // Bring this value back in range. All of the filter scaling factors\n            // are in fixed point with FIXED_FRAC_BITS bits of fractional part.\n            //\n            // (!) Add 1/2 of value before clamping to get proper rounding. In other\n            // case brightness loss will be noticeable if you resize image with white\n            // border and place it on white background.\n            //\n\n\n            dest[destOffset + 3] = clampTo8(a + (1 << 13) >> 14\n            /*FIXED_FRAC_BITS*/\n            );\n            dest[destOffset + 2] = clampTo8(b + (1 << 13) >> 14\n            /*FIXED_FRAC_BITS*/\n            );\n            dest[destOffset + 1] = clampTo8(g + (1 << 13) >> 14\n            /*FIXED_FRAC_BITS*/\n            );\n            dest[destOffset] = clampTo8(r + (1 << 13) >> 14\n            /*FIXED_FRAC_BITS*/\n            );\n            destOffset = destOffset + srcH * 4 | 0;\n          }\n\n          destOffset = (srcY + 1) * 4 | 0;\n          srcOffset = (srcY + 1) * srcW * 4 | 0;\n        }\n      }\n\n      module.exports = {\n        convolveHorizontally: convolveHorizontally,\n        convolveVertically: convolveVertically\n      };\n    }, {}],\n    3: [function (_dereq_, module, exports) {\n      // This is autogenerated file from math.wasm, don't edit.\n      //\n      'use strict';\n      /* eslint-disable max-len */\n\n      module.exports = 'AGFzbQEAAAAADAZkeWxpbmsAAAAAAAEXA2AAAGAGf39/f39/AGAHf39/f39/fwACDwEDZW52Bm1lbW9yeQIAAAMEAwABAgYGAX8AQQALB1cFEV9fd2FzbV9jYWxsX2N0b3JzAAAIY29udm9sdmUAAQpjb252b2x2ZUhWAAIMX19kc29faGFuZGxlAwAYX193YXNtX2FwcGx5X2RhdGFfcmVsb2NzAAAK7AMDAwABC8YDAQ9/AkAgA0UNACAERQ0AA0AgDCENQQAhE0EAIQcDQCAHQQJqIQYCfyAHQQF0IAVqIgcuAQIiFEUEQEGAwAAhCEGAwAAhCUGAwAAhCkGAwAAhCyAGDAELIBIgBy4BAGohCEEAIQsgFCEHQQAhDiAGIQlBACEPQQAhEANAIAUgCUEBdGouAQAiESAAIAhBAnRqKAIAIgpBGHZsIBBqIRAgCkH/AXEgEWwgC2ohCyAKQRB2Qf8BcSARbCAPaiEPIApBCHZB/wFxIBFsIA5qIQ4gCEEBaiEIIAlBAWohCSAHQQFrIgcNAAsgC0GAQGshCCAOQYBAayEJIA9BgEBrIQogEEGAQGshCyAGIBRqCyEHIAEgDUECdGogCUEOdSIGQf8BIAZB/wFIGyIGQQAgBkEAShtBCHRBgP4DcSAKQQ51IgZB/wEgBkH/AUgbIgZBACAGQQBKG0EQdEGAgPwHcSALQQ51IgZB/wEgBkH/AUgbIgZBACAGQQBKG0EYdHJyIAhBDnUiBkH/ASAGQf8BSBsiBkEAIAZBAEobcjYCACADIA1qIQ0gE0EBaiITIARHDQALIAxBAWoiDCACbCESIAMgDEcNAAsLCx4AQQAgAiADIAQgBSAAEAEgAkEAIAQgBSAGIAEQAQs=';\n    }, {}],\n    4: [function (_dereq_, module, exports) {\n      'use strict';\n\n      module.exports = {\n        name: 'resize',\n        fn: _dereq_('./resize'),\n        wasm_fn: _dereq_('./resize_wasm'),\n        wasm_src: _dereq_('./convolve_wasm_base64')\n      };\n    }, {\n      \"./convolve_wasm_base64\": 3,\n      \"./resize\": 5,\n      \"./resize_wasm\": 8\n    }],\n    5: [function (_dereq_, module, exports) {\n      'use strict';\n\n      var createFilters = _dereq_('./resize_filter_gen');\n\n      var convolveHorizontally = _dereq_('./convolve').convolveHorizontally;\n\n      var convolveVertically = _dereq_('./convolve').convolveVertically;\n\n      function resetAlpha(dst, width, height) {\n        var ptr = 3,\n            len = width * height * 4 | 0;\n\n        while (ptr < len) {\n          dst[ptr] = 0xFF;\n          ptr = ptr + 4 | 0;\n        }\n      }\n\n      module.exports = function resize(options) {\n        var src = options.src;\n        var srcW = options.width;\n        var srcH = options.height;\n        var destW = options.toWidth;\n        var destH = options.toHeight;\n        var scaleX = options.scaleX || options.toWidth / options.width;\n        var scaleY = options.scaleY || options.toHeight / options.height;\n        var offsetX = options.offsetX || 0;\n        var offsetY = options.offsetY || 0;\n        var dest = options.dest || new Uint8Array(destW * destH * 4);\n        var quality = typeof options.quality === 'undefined' ? 3 : options.quality;\n        var alpha = options.alpha || false;\n        var filtersX = createFilters(quality, srcW, destW, scaleX, offsetX),\n            filtersY = createFilters(quality, srcH, destH, scaleY, offsetY);\n        var tmp = new Uint8Array(destW * srcH * 4); // To use single function we need src & tmp of the same type.\n        // But src can be CanvasPixelArray, and tmp - Uint8Array. So, keep\n        // vertical and horizontal passes separately to avoid deoptimization.\n\n        convolveHorizontally(src, tmp, srcW, srcH, destW, filtersX);\n        convolveVertically(tmp, dest, srcH, destW, destH, filtersY); // That's faster than doing checks in convolver.\n        // !!! Note, canvas data is not premultipled. We don't need other\n        // alpha corrections.\n\n        if (!alpha) resetAlpha(dest, destW, destH);\n        return dest;\n      };\n    }, {\n      \"./convolve\": 2,\n      \"./resize_filter_gen\": 6\n    }],\n    6: [function (_dereq_, module, exports) {\n      // Calculate convolution filters for each destination point,\n      // and pack data to Int16Array:\n      //\n      // [ shift, length, data..., shift2, length2, data..., ... ]\n      //\n      // - shift - offset in src image\n      // - length - filter length (in src points)\n      // - data - filter values sequence\n      //\n      'use strict';\n\n      var FILTER_INFO = _dereq_('./resize_filter_info'); // Precision of fixed FP values\n\n\n      var FIXED_FRAC_BITS = 14;\n\n      function toFixedPoint(num) {\n        return Math.round(num * ((1 << FIXED_FRAC_BITS) - 1));\n      }\n\n      module.exports = function resizeFilterGen(quality, srcSize, destSize, scale, offset) {\n        var filterFunction = FILTER_INFO[quality].filter;\n        var scaleInverted = 1.0 / scale;\n        var scaleClamped = Math.min(1.0, scale); // For upscale\n        // Filter window (averaging interval), scaled to src image\n\n        var srcWindow = FILTER_INFO[quality].win / scaleClamped;\n        var destPixel, srcPixel, srcFirst, srcLast, filterElementSize, floatFilter, fxpFilter, total, pxl, idx, floatVal, filterTotal, filterVal;\n        var leftNotEmpty, rightNotEmpty, filterShift, filterSize;\n        var maxFilterElementSize = Math.floor((srcWindow + 1) * 2);\n        var packedFilter = new Int16Array((maxFilterElementSize + 2) * destSize);\n        var packedFilterPtr = 0;\n        var slowCopy = !packedFilter.subarray || !packedFilter.set; // For each destination pixel calculate source range and built filter values\n\n        for (destPixel = 0; destPixel < destSize; destPixel++) {\n          // Scaling should be done relative to central pixel point\n          srcPixel = (destPixel + 0.5) * scaleInverted + offset;\n          srcFirst = Math.max(0, Math.floor(srcPixel - srcWindow));\n          srcLast = Math.min(srcSize - 1, Math.ceil(srcPixel + srcWindow));\n          filterElementSize = srcLast - srcFirst + 1;\n          floatFilter = new Float32Array(filterElementSize);\n          fxpFilter = new Int16Array(filterElementSize);\n          total = 0.0; // Fill filter values for calculated range\n\n          for (pxl = srcFirst, idx = 0; pxl <= srcLast; pxl++, idx++) {\n            floatVal = filterFunction((pxl + 0.5 - srcPixel) * scaleClamped);\n            total += floatVal;\n            floatFilter[idx] = floatVal;\n          } // Normalize filter, convert to fixed point and accumulate conversion error\n\n\n          filterTotal = 0;\n\n          for (idx = 0; idx < floatFilter.length; idx++) {\n            filterVal = floatFilter[idx] / total;\n            filterTotal += filterVal;\n            fxpFilter[idx] = toFixedPoint(filterVal);\n          } // Compensate normalization error, to minimize brightness drift\n\n\n          fxpFilter[destSize >> 1] += toFixedPoint(1.0 - filterTotal); //\n          // Now pack filter to useable form\n          //\n          // 1. Trim heading and tailing zero values, and compensate shitf/length\n          // 2. Put all to single array in this format:\n          //\n          //    [ pos shift, data length, value1, value2, value3, ... ]\n          //\n\n          leftNotEmpty = 0;\n\n          while (leftNotEmpty < fxpFilter.length && fxpFilter[leftNotEmpty] === 0) {\n            leftNotEmpty++;\n          }\n\n          if (leftNotEmpty < fxpFilter.length) {\n            rightNotEmpty = fxpFilter.length - 1;\n\n            while (rightNotEmpty > 0 && fxpFilter[rightNotEmpty] === 0) {\n              rightNotEmpty--;\n            }\n\n            filterShift = srcFirst + leftNotEmpty;\n            filterSize = rightNotEmpty - leftNotEmpty + 1;\n            packedFilter[packedFilterPtr++] = filterShift; // shift\n\n            packedFilter[packedFilterPtr++] = filterSize; // size\n\n            if (!slowCopy) {\n              packedFilter.set(fxpFilter.subarray(leftNotEmpty, rightNotEmpty + 1), packedFilterPtr);\n              packedFilterPtr += filterSize;\n            } else {\n              // fallback for old IE < 11, without subarray/set methods\n              for (idx = leftNotEmpty; idx <= rightNotEmpty; idx++) {\n                packedFilter[packedFilterPtr++] = fxpFilter[idx];\n              }\n            }\n          } else {\n            // zero data, write header only\n            packedFilter[packedFilterPtr++] = 0; // shift\n\n            packedFilter[packedFilterPtr++] = 0; // size\n          }\n        }\n\n        return packedFilter;\n      };\n    }, {\n      \"./resize_filter_info\": 7\n    }],\n    7: [function (_dereq_, module, exports) {\n      // Filter definitions to build tables for\n      // resizing convolvers.\n      //\n      // Presets for quality 0..3. Filter functions + window size\n      //\n      'use strict';\n\n      module.exports = [{\n        // Nearest neibor (Box)\n        win: 0.5,\n        filter: function filter(x) {\n          return x >= -0.5 && x < 0.5 ? 1.0 : 0.0;\n        }\n      }, {\n        // Hamming\n        win: 1.0,\n        filter: function filter(x) {\n          if (x <= -1.0 || x >= 1.0) {\n            return 0.0;\n          }\n\n          if (x > -1.19209290E-07 && x < 1.19209290E-07) {\n            return 1.0;\n          }\n\n          var xpi = x * Math.PI;\n          return Math.sin(xpi) / xpi * (0.54 + 0.46 * Math.cos(xpi / 1.0));\n        }\n      }, {\n        // Lanczos, win = 2\n        win: 2.0,\n        filter: function filter(x) {\n          if (x <= -2.0 || x >= 2.0) {\n            return 0.0;\n          }\n\n          if (x > -1.19209290E-07 && x < 1.19209290E-07) {\n            return 1.0;\n          }\n\n          var xpi = x * Math.PI;\n          return Math.sin(xpi) / xpi * Math.sin(xpi / 2.0) / (xpi / 2.0);\n        }\n      }, {\n        // Lanczos, win = 3\n        win: 3.0,\n        filter: function filter(x) {\n          if (x <= -3.0 || x >= 3.0) {\n            return 0.0;\n          }\n\n          if (x > -1.19209290E-07 && x < 1.19209290E-07) {\n            return 1.0;\n          }\n\n          var xpi = x * Math.PI;\n          return Math.sin(xpi) / xpi * Math.sin(xpi / 3.0) / (xpi / 3.0);\n        }\n      }];\n    }, {}],\n    8: [function (_dereq_, module, exports) {\n      'use strict';\n\n      var createFilters = _dereq_('./resize_filter_gen');\n\n      function resetAlpha(dst, width, height) {\n        var ptr = 3,\n            len = width * height * 4 | 0;\n\n        while (ptr < len) {\n          dst[ptr] = 0xFF;\n          ptr = ptr + 4 | 0;\n        }\n      }\n\n      function asUint8Array(src) {\n        return new Uint8Array(src.buffer, 0, src.byteLength);\n      }\n\n      var IS_LE = true; // should not crash everything on module load in old browsers\n\n      try {\n        IS_LE = new Uint32Array(new Uint8Array([1, 0, 0, 0]).buffer)[0] === 1;\n      } catch (__) {}\n\n      function copyInt16asLE(src, target, target_offset) {\n        if (IS_LE) {\n          target.set(asUint8Array(src), target_offset);\n          return;\n        }\n\n        for (var ptr = target_offset, i = 0; i < src.length; i++) {\n          var data = src[i];\n          target[ptr++] = data & 0xFF;\n          target[ptr++] = data >> 8 & 0xFF;\n        }\n      }\n\n      module.exports = function resize_wasm(options) {\n        var src = options.src;\n        var srcW = options.width;\n        var srcH = options.height;\n        var destW = options.toWidth;\n        var destH = options.toHeight;\n        var scaleX = options.scaleX || options.toWidth / options.width;\n        var scaleY = options.scaleY || options.toHeight / options.height;\n        var offsetX = options.offsetX || 0.0;\n        var offsetY = options.offsetY || 0.0;\n        var dest = options.dest || new Uint8Array(destW * destH * 4);\n        var quality = typeof options.quality === 'undefined' ? 3 : options.quality;\n        var alpha = options.alpha || false;\n        var filtersX = createFilters(quality, srcW, destW, scaleX, offsetX),\n            filtersY = createFilters(quality, srcH, destH, scaleY, offsetY); // destination is 0 too.\n\n        var src_offset = 0; // buffer between convolve passes\n\n        var tmp_offset = this.__align(src_offset + Math.max(src.byteLength, dest.byteLength));\n\n        var filtersX_offset = this.__align(tmp_offset + srcH * destW * 4);\n\n        var filtersY_offset = this.__align(filtersX_offset + filtersX.byteLength);\n\n        var alloc_bytes = filtersY_offset + filtersY.byteLength;\n\n        var instance = this.__instance('resize', alloc_bytes); //\n        // Fill memory block with data to process\n        //\n\n\n        var mem = new Uint8Array(this.__memory.buffer);\n        var mem32 = new Uint32Array(this.__memory.buffer); // 32-bit copy is much faster in chrome\n\n        var src32 = new Uint32Array(src.buffer);\n        mem32.set(src32); // We should guarantee LE bytes order. Filters are not big, so\n        // speed difference is not significant vs direct .set()\n\n        copyInt16asLE(filtersX, mem, filtersX_offset);\n        copyInt16asLE(filtersY, mem, filtersY_offset); //\n        // Now call webassembly method\n        // emsdk does method names with '_'\n\n        var fn = instance.exports.convolveHV || instance.exports._convolveHV;\n        fn(filtersX_offset, filtersY_offset, tmp_offset, srcW, srcH, destW, destH); //\n        // Copy data back to typed array\n        //\n        // 32-bit copy is much faster in chrome\n\n        var dest32 = new Uint32Array(dest.buffer);\n        dest32.set(new Uint32Array(this.__memory.buffer, 0, destH * destW)); // That's faster than doing checks in convolver.\n        // !!! Note, canvas data is not premultipled. We don't need other\n        // alpha corrections.\n\n        if (!alpha) resetAlpha(dest, destW, destH);\n        return dest;\n      };\n    }, {\n      \"./resize_filter_gen\": 6\n    }],\n    9: [function (_dereq_, module, exports) {\n      'use strict';\n\n      module.exports = {\n        name: 'unsharp_mask',\n        fn: _dereq_('./unsharp_mask'),\n        wasm_fn: _dereq_('./unsharp_mask_wasm'),\n        wasm_src: _dereq_('./unsharp_mask_wasm_base64')\n      };\n    }, {\n      \"./unsharp_mask\": 10,\n      \"./unsharp_mask_wasm\": 11,\n      \"./unsharp_mask_wasm_base64\": 12\n    }],\n    10: [function (_dereq_, module, exports) {\n      // Unsharp mask filter\n      //\n      // http://stackoverflow.com/a/23322820/1031804\n      // USM(O) = O + (2 * (Amount / 100) * (O - GB))\n      // GB - gaussian blur.\n      //\n      // Image is converted from RGB to HSV, unsharp mask is applied to the\n      // brightness channel and then image is converted back to RGB.\n      //\n      'use strict';\n\n      var glur_mono16 = _dereq_('glur/mono16');\n\n      function hsv_v16(img, width, height) {\n        var size = width * height;\n        var out = new Uint16Array(size);\n        var r, g, b, max;\n\n        for (var i = 0; i < size; i++) {\n          r = img[4 * i];\n          g = img[4 * i + 1];\n          b = img[4 * i + 2];\n          max = r >= g && r >= b ? r : g >= b && g >= r ? g : b;\n          out[i] = max << 8;\n        }\n\n        return out;\n      }\n\n      module.exports = function unsharp(img, width, height, amount, radius, threshold) {\n        var v1, v2, vmul;\n        var diff, iTimes4;\n\n        if (amount === 0 || radius < 0.5) {\n          return;\n        }\n\n        if (radius > 2.0) {\n          radius = 2.0;\n        }\n\n        var brightness = hsv_v16(img, width, height);\n        var blured = new Uint16Array(brightness); // copy, because blur modify src\n\n        glur_mono16(blured, width, height, radius);\n        var amountFp = amount / 100 * 0x1000 + 0.5 | 0;\n        var thresholdFp = threshold << 8;\n        var size = width * height;\n        /* eslint-disable indent */\n\n        for (var i = 0; i < size; i++) {\n          v1 = brightness[i];\n          diff = v1 - blured[i];\n\n          if (Math.abs(diff) >= thresholdFp) {\n            // add unsharp mask to the brightness channel\n            v2 = v1 + (amountFp * diff + 0x800 >> 12); // Both v1 and v2 are within [0.0 .. 255.0] (0000-FF00) range, never going into\n            // [255.003 .. 255.996] (FF01-FFFF). This allows to round this value as (x+.5)|0\n            // later without overflowing.\n\n            v2 = v2 > 0xff00 ? 0xff00 : v2;\n            v2 = v2 < 0x0000 ? 0x0000 : v2; // Avoid division by 0. V=0 means rgb(0,0,0), unsharp with unsharpAmount>0 cannot\n            // change this value (because diff between colors gets inflated), so no need to verify correctness.\n\n            v1 = v1 !== 0 ? v1 : 1; // Multiplying V in HSV model by a constant is equivalent to multiplying each component\n            // in RGB by the same constant (same for HSL), see also:\n            // https://beesbuzz.biz/code/16-hsv-color-transforms\n\n            vmul = (v2 << 12) / v1 | 0; // Result will be in [0..255] range because:\n            //  - all numbers are positive\n            //  - r,g,b <= (v1/256)\n            //  - r,g,b,(v1/256),(v2/256) <= 255\n            // So highest this number can get is X*255/X+0.5=255.5 which is < 256 and rounds down.\n\n            iTimes4 = i * 4;\n            img[iTimes4] = img[iTimes4] * vmul + 0x800 >> 12; // R\n\n            img[iTimes4 + 1] = img[iTimes4 + 1] * vmul + 0x800 >> 12; // G\n\n            img[iTimes4 + 2] = img[iTimes4 + 2] * vmul + 0x800 >> 12; // B\n          }\n        }\n      };\n    }, {\n      \"glur/mono16\": 18\n    }],\n    11: [function (_dereq_, module, exports) {\n      'use strict';\n\n      module.exports = function unsharp(img, width, height, amount, radius, threshold) {\n        if (amount === 0 || radius < 0.5) {\n          return;\n        }\n\n        if (radius > 2.0) {\n          radius = 2.0;\n        }\n\n        var pixels = width * height;\n        var img_bytes_cnt = pixels * 4;\n        var hsv_bytes_cnt = pixels * 2;\n        var blur_bytes_cnt = pixels * 2;\n        var blur_line_byte_cnt = Math.max(width, height) * 4; // float32 array\n\n        var blur_coeffs_byte_cnt = 8 * 4; // float32 array\n\n        var img_offset = 0;\n        var hsv_offset = img_bytes_cnt;\n        var blur_offset = hsv_offset + hsv_bytes_cnt;\n        var blur_tmp_offset = blur_offset + blur_bytes_cnt;\n        var blur_line_offset = blur_tmp_offset + blur_bytes_cnt;\n        var blur_coeffs_offset = blur_line_offset + blur_line_byte_cnt;\n\n        var instance = this.__instance('unsharp_mask', img_bytes_cnt + hsv_bytes_cnt + blur_bytes_cnt * 2 + blur_line_byte_cnt + blur_coeffs_byte_cnt, {\n          exp: Math.exp\n        }); // 32-bit copy is much faster in chrome\n\n\n        var img32 = new Uint32Array(img.buffer);\n        var mem32 = new Uint32Array(this.__memory.buffer);\n        mem32.set(img32); // HSL\n\n        var fn = instance.exports.hsv_v16 || instance.exports._hsv_v16;\n        fn(img_offset, hsv_offset, width, height); // BLUR\n\n        fn = instance.exports.blurMono16 || instance.exports._blurMono16;\n        fn(hsv_offset, blur_offset, blur_tmp_offset, blur_line_offset, blur_coeffs_offset, width, height, radius); // UNSHARP\n\n        fn = instance.exports.unsharp || instance.exports._unsharp;\n        fn(img_offset, img_offset, hsv_offset, blur_offset, width, height, amount, threshold); // 32-bit copy is much faster in chrome\n\n        img32.set(new Uint32Array(this.__memory.buffer, 0, pixels));\n      };\n    }, {}],\n    12: [function (_dereq_, module, exports) {\n      // This is autogenerated file from math.wasm, don't edit.\n      //\n      'use strict';\n      /* eslint-disable max-len */\n\n      module.exports = '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';\n    }, {}],\n    13: [function (_dereq_, module, exports) {\n      'use strict';\n\n      var GC_INTERVAL = 100;\n\n      function Pool(create, idle) {\n        this.create = create;\n        this.available = [];\n        this.acquired = {};\n        this.lastId = 1;\n        this.timeoutId = 0;\n        this.idle = idle || 2000;\n      }\n\n      Pool.prototype.acquire = function () {\n        var _this = this;\n\n        var resource;\n\n        if (this.available.length !== 0) {\n          resource = this.available.pop();\n        } else {\n          resource = this.create();\n          resource.id = this.lastId++;\n\n          resource.release = function () {\n            return _this.release(resource);\n          };\n        }\n\n        this.acquired[resource.id] = resource;\n        return resource;\n      };\n\n      Pool.prototype.release = function (resource) {\n        var _this2 = this;\n\n        delete this.acquired[resource.id];\n        resource.lastUsed = Date.now();\n        this.available.push(resource);\n\n        if (this.timeoutId === 0) {\n          this.timeoutId = setTimeout(function () {\n            return _this2.gc();\n          }, GC_INTERVAL);\n        }\n      };\n\n      Pool.prototype.gc = function () {\n        var _this3 = this;\n\n        var now = Date.now();\n        this.available = this.available.filter(function (resource) {\n          if (now - resource.lastUsed > _this3.idle) {\n            resource.destroy();\n            return false;\n          }\n\n          return true;\n        });\n\n        if (this.available.length !== 0) {\n          this.timeoutId = setTimeout(function () {\n            return _this3.gc();\n          }, GC_INTERVAL);\n        } else {\n          this.timeoutId = 0;\n        }\n      };\n\n      module.exports = Pool;\n    }, {}],\n    14: [function (_dereq_, module, exports) {\n      // Add intermediate resizing steps when scaling down by a very large factor.\n      //\n      // For example, when resizing 10000x10000 down to 10x10, it'll resize it to\n      // 300x300 first.\n      //\n      // It's needed because tiler has issues when the entire tile is scaled down\n      // to a few pixels (1024px source tile with border size 3 should result in\n      // at least 3+3+2 = 8px target tile, so max scale factor is 128 here).\n      //\n      // Also, adding intermediate steps can speed up processing if we use lower\n      // quality algorithms for first stages.\n      //\n      'use strict'; // min size = 0 results in infinite loop,\n      // min size = 1 can consume large amount of memory\n\n      var MIN_INNER_TILE_SIZE = 2;\n\n      module.exports = function createStages(fromWidth, fromHeight, toWidth, toHeight, srcTileSize, destTileBorder) {\n        var scaleX = toWidth / fromWidth;\n        var scaleY = toHeight / fromHeight; // derived from createRegions equation:\n        // innerTileWidth = pixelFloor(srcTileSize * scaleX) - 2 * destTileBorder;\n\n        var minScale = (2 * destTileBorder + MIN_INNER_TILE_SIZE + 1) / srcTileSize; // refuse to scale image multiple times by less than twice each time,\n        // it could only happen because of invalid options\n\n        if (minScale > 0.5) return [[toWidth, toHeight]];\n        var stageCount = Math.ceil(Math.log(Math.min(scaleX, scaleY)) / Math.log(minScale)); // no additional resizes are necessary,\n        // stageCount can be zero or be negative when enlarging the image\n\n        if (stageCount <= 1) return [[toWidth, toHeight]];\n        var result = [];\n\n        for (var i = 0; i < stageCount; i++) {\n          var width = Math.round(Math.pow(Math.pow(fromWidth, stageCount - i - 1) * Math.pow(toWidth, i + 1), 1 / stageCount));\n          var height = Math.round(Math.pow(Math.pow(fromHeight, stageCount - i - 1) * Math.pow(toHeight, i + 1), 1 / stageCount));\n          result.push([width, height]);\n        }\n\n        return result;\n      };\n    }, {}],\n    15: [function (_dereq_, module, exports) {\n      // Split original image into multiple 1024x1024 chunks to reduce memory usage\n      // (images have to be unpacked into typed arrays for resizing) and allow\n      // parallel processing of multiple tiles at a time.\n      //\n      'use strict';\n      /*\n       * pixelFloor and pixelCeil are modified versions of Math.floor and Math.ceil\n       * functions which take into account floating point arithmetic errors.\n       * Those errors can cause undesired increments/decrements of sizes and offsets:\n       * Math.ceil(36 / (36 / 500)) = 501\n       * pixelCeil(36 / (36 / 500)) = 500\n       */\n\n      var PIXEL_EPSILON = 1e-5;\n\n      function pixelFloor(x) {\n        var nearest = Math.round(x);\n\n        if (Math.abs(x - nearest) < PIXEL_EPSILON) {\n          return nearest;\n        }\n\n        return Math.floor(x);\n      }\n\n      function pixelCeil(x) {\n        var nearest = Math.round(x);\n\n        if (Math.abs(x - nearest) < PIXEL_EPSILON) {\n          return nearest;\n        }\n\n        return Math.ceil(x);\n      }\n\n      module.exports = function createRegions(options) {\n        var scaleX = options.toWidth / options.width;\n        var scaleY = options.toHeight / options.height;\n        var innerTileWidth = pixelFloor(options.srcTileSize * scaleX) - 2 * options.destTileBorder;\n        var innerTileHeight = pixelFloor(options.srcTileSize * scaleY) - 2 * options.destTileBorder; // prevent infinite loop, this should never happen\n\n        if (innerTileWidth < 1 || innerTileHeight < 1) {\n          throw new Error('Internal error in pica: target tile width/height is too small.');\n        }\n\n        var x, y;\n        var innerX, innerY, toTileWidth, toTileHeight;\n        var tiles = [];\n        var tile; // we go top-to-down instead of left-to-right to make image displayed from top to\n        // doesn in the browser\n\n        for (innerY = 0; innerY < options.toHeight; innerY += innerTileHeight) {\n          for (innerX = 0; innerX < options.toWidth; innerX += innerTileWidth) {\n            x = innerX - options.destTileBorder;\n\n            if (x < 0) {\n              x = 0;\n            }\n\n            toTileWidth = innerX + innerTileWidth + options.destTileBorder - x;\n\n            if (x + toTileWidth >= options.toWidth) {\n              toTileWidth = options.toWidth - x;\n            }\n\n            y = innerY - options.destTileBorder;\n\n            if (y < 0) {\n              y = 0;\n            }\n\n            toTileHeight = innerY + innerTileHeight + options.destTileBorder - y;\n\n            if (y + toTileHeight >= options.toHeight) {\n              toTileHeight = options.toHeight - y;\n            }\n\n            tile = {\n              toX: x,\n              toY: y,\n              toWidth: toTileWidth,\n              toHeight: toTileHeight,\n              toInnerX: innerX,\n              toInnerY: innerY,\n              toInnerWidth: innerTileWidth,\n              toInnerHeight: innerTileHeight,\n              offsetX: x / scaleX - pixelFloor(x / scaleX),\n              offsetY: y / scaleY - pixelFloor(y / scaleY),\n              scaleX: scaleX,\n              scaleY: scaleY,\n              x: pixelFloor(x / scaleX),\n              y: pixelFloor(y / scaleY),\n              width: pixelCeil(toTileWidth / scaleX),\n              height: pixelCeil(toTileHeight / scaleY)\n            };\n            tiles.push(tile);\n          }\n        }\n\n        return tiles;\n      };\n    }, {}],\n    16: [function (_dereq_, module, exports) {\n      'use strict';\n\n      function objClass(obj) {\n        return Object.prototype.toString.call(obj);\n      }\n\n      module.exports.isCanvas = function isCanvas(element) {\n        var cname = objClass(element);\n        return cname === '[object HTMLCanvasElement]'\n        /* browser */\n        || cname === '[object OffscreenCanvas]' || cname === '[object Canvas]'\n        /* node-canvas */\n        ;\n      };\n\n      module.exports.isImage = function isImage(element) {\n        return objClass(element) === '[object HTMLImageElement]';\n      };\n\n      module.exports.isImageBitmap = function isImageBitmap(element) {\n        return objClass(element) === '[object ImageBitmap]';\n      };\n\n      module.exports.limiter = function limiter(concurrency) {\n        var active = 0,\n            queue = [];\n\n        function roll() {\n          if (active < concurrency && queue.length) {\n            active++;\n            queue.shift()();\n          }\n        }\n\n        return function limit(fn) {\n          return new Promise(function (resolve, reject) {\n            queue.push(function () {\n              fn().then(function (result) {\n                resolve(result);\n                active--;\n                roll();\n              }, function (err) {\n                reject(err);\n                active--;\n                roll();\n              });\n            });\n            roll();\n          });\n        };\n      };\n\n      module.exports.cib_quality_name = function cib_quality_name(num) {\n        switch (num) {\n          case 0:\n            return 'pixelated';\n\n          case 1:\n            return 'low';\n\n          case 2:\n            return 'medium';\n        }\n\n        return 'high';\n      };\n\n      module.exports.cib_support = function cib_support(createCanvas) {\n        return Promise.resolve().then(function () {\n          if (typeof createImageBitmap === 'undefined') {\n            return false;\n          }\n\n          var c = createCanvas(100, 100);\n          return createImageBitmap(c, 0, 0, 100, 100, {\n            resizeWidth: 10,\n            resizeHeight: 10,\n            resizeQuality: 'high'\n          }).then(function (bitmap) {\n            var status = bitmap.width === 10; // Branch below is filtered on upper level. We do not call resize\n            // detection for basic ImageBitmap.\n            //\n            // https://developer.mozilla.org/en-US/docs/Web/API/ImageBitmap\n            // old Crome 51 has ImageBitmap without .close(). Then this code\n            // will throw and return 'false' as expected.\n            //\n\n            bitmap.close();\n            c = null;\n            return status;\n          });\n        })[\"catch\"](function () {\n          return false;\n        });\n      };\n\n      module.exports.worker_offscreen_canvas_support = function worker_offscreen_canvas_support() {\n        return new Promise(function (resolve, reject) {\n          if (typeof OffscreenCanvas === 'undefined') {\n            // if OffscreenCanvas is present, we assume browser supports Worker and built-in Promise as well\n            resolve(false);\n            return;\n          }\n\n          function workerPayload(self) {\n            if (typeof createImageBitmap === 'undefined') {\n              self.postMessage(false);\n              return;\n            }\n\n            Promise.resolve().then(function () {\n              var canvas = new OffscreenCanvas(10, 10); // test that 2d context can be used in worker\n\n              var ctx = canvas.getContext('2d');\n              ctx.rect(0, 0, 1, 1); // test that cib can be used to return image bitmap from worker\n\n              return createImageBitmap(canvas, 0, 0, 1, 1);\n            }).then(function () {\n              return self.postMessage(true);\n            }, function () {\n              return self.postMessage(false);\n            });\n          }\n\n          var code = btoa(\"(\".concat(workerPayload.toString(), \")(self);\"));\n          var w = new Worker(\"data:text/javascript;base64,\".concat(code));\n\n          w.onmessage = function (ev) {\n            return resolve(ev.data);\n          };\n\n          w.onerror = reject;\n        }).then(function (result) {\n          return result;\n        }, function () {\n          return false;\n        });\n      }; // Check if canvas.getContext('2d').getImageData can be used,\n      // FireFox randomizes the output of that function in `privacy.resistFingerprinting` mode\n\n\n      module.exports.can_use_canvas = function can_use_canvas(createCanvas) {\n        var usable = false;\n\n        try {\n          var canvas = createCanvas(2, 1);\n          var ctx = canvas.getContext('2d');\n          var d = ctx.createImageData(2, 1);\n          d.data[0] = 12;\n          d.data[1] = 23;\n          d.data[2] = 34;\n          d.data[3] = 255;\n          d.data[4] = 45;\n          d.data[5] = 56;\n          d.data[6] = 67;\n          d.data[7] = 255;\n          ctx.putImageData(d, 0, 0);\n          d = null;\n          d = ctx.getImageData(0, 0, 2, 1);\n\n          if (d.data[0] === 12 && d.data[1] === 23 && d.data[2] === 34 && d.data[3] === 255 && d.data[4] === 45 && d.data[5] === 56 && d.data[6] === 67 && d.data[7] === 255) {\n            usable = true;\n          }\n        } catch (err) {}\n\n        return usable;\n      }; // Check if createImageBitmap(img, sx, sy, sw, sh) signature works correctly\n      // with JPEG images oriented with Exif;\n      // https://bugs.chromium.org/p/chromium/issues/detail?id=1220671\n      // TODO: remove after it's fixed in chrome for at least 2 releases\n\n\n      module.exports.cib_can_use_region = function cib_can_use_region() {\n        return new Promise(function (resolve) {\n          if (typeof createImageBitmap === 'undefined') {\n            resolve(false);\n            return;\n          }\n\n          var image = new Image();\n          image.src = 'data:image/jpeg;base64,' + '/9j/4QBiRXhpZgAATU0AKgAAAAgABQESAAMAAAABAAYAAAEaAAUAAAABAAAASgEbAAUAA' + 'AABAAAAUgEoAAMAAAABAAIAAAITAAMAAAABAAEAAAAAAAAAAABIAAAAAQAAAEgAAAAB/9' + 'sAQwAEAwMEAwMEBAMEBQQEBQYKBwYGBgYNCQoICg8NEBAPDQ8OERMYFBESFxIODxUcFRc' + 'ZGRsbGxAUHR8dGh8YGhsa/9sAQwEEBQUGBQYMBwcMGhEPERoaGhoaGhoaGhoaGhoaGhoa' + 'GhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoa/8IAEQgAAQACAwERAAIRAQMRA' + 'f/EABQAAQAAAAAAAAAAAAAAAAAAAAf/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAA' + 'IQAxAAAAF/P//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAQUCf//EABQRAQAAAAA' + 'AAAAAAAAAAAAAAAD/2gAIAQMBAT8Bf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIB' + 'AT8Bf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEABj8Cf//EABQQAQAAAAAAAAAAA' + 'AAAAAAAAAD/2gAIAQEAAT8hf//aAAwDAQACAAMAAAAQH//EABQRAQAAAAAAAAAAAAAAAA' + 'AAAAD/2gAIAQMBAT8Qf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Qf//EABQ' + 'QAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8Qf//Z';\n\n          image.onload = function () {\n            createImageBitmap(image, 0, 0, image.width, image.height).then(function (bitmap) {\n              if (bitmap.width === image.width && bitmap.height === image.height) {\n                resolve(true);\n              } else {\n                resolve(false);\n              }\n            }, function () {\n              return resolve(false);\n            });\n          };\n\n          image.onerror = function () {\n            return resolve(false);\n          };\n        });\n      };\n    }, {}],\n    17: [function (_dereq_, module, exports) {\n      // Web Worker wrapper for image resize function\n      'use strict';\n\n      module.exports = function () {\n        var MathLib = _dereq_('./mathlib');\n\n        var mathLib;\n        /* eslint-disable no-undef */\n\n        onmessage = function onmessage(ev) {\n          var tileOpts = ev.data.opts;\n          var returnBitmap = false;\n\n          if (!tileOpts.src && tileOpts.srcBitmap) {\n            var canvas = new OffscreenCanvas(tileOpts.width, tileOpts.height);\n            var ctx = canvas.getContext('2d', {\n              alpha: Boolean(tileOpts.alpha)\n            });\n            ctx.drawImage(tileOpts.srcBitmap, 0, 0);\n            tileOpts.src = ctx.getImageData(0, 0, tileOpts.width, tileOpts.height).data;\n            canvas.width = canvas.height = 0;\n            canvas = null;\n            tileOpts.srcBitmap.close();\n            tileOpts.srcBitmap = null;\n            returnBitmap = true;\n          }\n\n          if (!mathLib) mathLib = new MathLib(ev.data.features); // Use multimath's sync auto-init. Avoid Promise use in old browsers,\n          // because polyfills are not propagated to webworker.\n\n          var data = mathLib.resizeAndUnsharp(tileOpts);\n\n          if (returnBitmap) {\n            var toImageData = new ImageData(new Uint8ClampedArray(data), tileOpts.toWidth, tileOpts.toHeight);\n\n            var _canvas = new OffscreenCanvas(tileOpts.toWidth, tileOpts.toHeight);\n\n            var _ctx = _canvas.getContext('2d', {\n              alpha: Boolean(tileOpts.alpha)\n            });\n\n            _ctx.putImageData(toImageData, 0, 0);\n\n            createImageBitmap(_canvas).then(function (bitmap) {\n              postMessage({\n                bitmap: bitmap\n              }, [bitmap]);\n            });\n          } else {\n            postMessage({\n              data: data\n            }, [data.buffer]);\n          }\n        };\n      };\n    }, {\n      \"./mathlib\": 1\n    }],\n    18: [function (_dereq_, module, exports) {\n      // Calculate Gaussian blur of an image using IIR filter\n      // The method is taken from Intel's white paper and code example attached to it:\n      // https://software.intel.com/en-us/articles/iir-gaussian-blur-filter\n      // -implementation-using-intel-advanced-vector-extensions\n      var a0, a1, a2, a3, b1, b2, left_corner, right_corner;\n\n      function gaussCoef(sigma) {\n        if (sigma < 0.5) {\n          sigma = 0.5;\n        }\n\n        var a = Math.exp(0.726 * 0.726) / sigma,\n            g1 = Math.exp(-a),\n            g2 = Math.exp(-2 * a),\n            k = (1 - g1) * (1 - g1) / (1 + 2 * a * g1 - g2);\n        a0 = k;\n        a1 = k * (a - 1) * g1;\n        a2 = k * (a + 1) * g1;\n        a3 = -k * g2;\n        b1 = 2 * g1;\n        b2 = -g2;\n        left_corner = (a0 + a1) / (1 - b1 - b2);\n        right_corner = (a2 + a3) / (1 - b1 - b2); // Attempt to force type to FP32.\n\n        return new Float32Array([a0, a1, a2, a3, b1, b2, left_corner, right_corner]);\n      }\n\n      function convolveMono16(src, out, line, coeff, width, height) {\n        // takes src image and writes the blurred and transposed result into out\n        var prev_src, curr_src, curr_out, prev_out, prev_prev_out;\n        var src_index, out_index, line_index;\n        var i, j;\n        var coeff_a0, coeff_a1, coeff_b1, coeff_b2;\n\n        for (i = 0; i < height; i++) {\n          src_index = i * width;\n          out_index = i;\n          line_index = 0; // left to right\n\n          prev_src = src[src_index];\n          prev_prev_out = prev_src * coeff[6];\n          prev_out = prev_prev_out;\n          coeff_a0 = coeff[0];\n          coeff_a1 = coeff[1];\n          coeff_b1 = coeff[4];\n          coeff_b2 = coeff[5];\n\n          for (j = 0; j < width; j++) {\n            curr_src = src[src_index];\n            curr_out = curr_src * coeff_a0 + prev_src * coeff_a1 + prev_out * coeff_b1 + prev_prev_out * coeff_b2;\n            prev_prev_out = prev_out;\n            prev_out = curr_out;\n            prev_src = curr_src;\n            line[line_index] = prev_out;\n            line_index++;\n            src_index++;\n          }\n\n          src_index--;\n          line_index--;\n          out_index += height * (width - 1); // right to left\n\n          prev_src = src[src_index];\n          prev_prev_out = prev_src * coeff[7];\n          prev_out = prev_prev_out;\n          curr_src = prev_src;\n          coeff_a0 = coeff[2];\n          coeff_a1 = coeff[3];\n\n          for (j = width - 1; j >= 0; j--) {\n            curr_out = curr_src * coeff_a0 + prev_src * coeff_a1 + prev_out * coeff_b1 + prev_prev_out * coeff_b2;\n            prev_prev_out = prev_out;\n            prev_out = curr_out;\n            prev_src = curr_src;\n            curr_src = src[src_index];\n            out[out_index] = line[line_index] + prev_out;\n            src_index--;\n            line_index--;\n            out_index -= height;\n          }\n        }\n      }\n\n      function blurMono16(src, width, height, radius) {\n        // Quick exit on zero radius\n        if (!radius) {\n          return;\n        }\n\n        var out = new Uint16Array(src.length),\n            tmp_line = new Float32Array(Math.max(width, height));\n        var coeff = gaussCoef(radius);\n        convolveMono16(src, out, tmp_line, coeff, width, height, radius);\n        convolveMono16(out, src, tmp_line, coeff, height, width, radius);\n      }\n\n      module.exports = blurMono16;\n    }, {}],\n    19: [function (_dereq_, module, exports) {\n      if (typeof Object.create === 'function') {\n        // implementation from standard node.js 'util' module\n        module.exports = function inherits(ctor, superCtor) {\n          if (superCtor) {\n            ctor.super_ = superCtor;\n            ctor.prototype = Object.create(superCtor.prototype, {\n              constructor: {\n                value: ctor,\n                enumerable: false,\n                writable: true,\n                configurable: true\n              }\n            });\n          }\n        };\n      } else {\n        // old school shim for old browsers\n        module.exports = function inherits(ctor, superCtor) {\n          if (superCtor) {\n            ctor.super_ = superCtor;\n\n            var TempCtor = function TempCtor() {};\n\n            TempCtor.prototype = superCtor.prototype;\n            ctor.prototype = new TempCtor();\n            ctor.prototype.constructor = ctor;\n          }\n        };\n      }\n    }, {}],\n    20: [function (_dereq_, module, exports) {\n      'use strict';\n\n      var assign = _dereq_('object-assign');\n\n      var base64decode = _dereq_('./lib/base64decode');\n\n      var hasWebAssembly = _dereq_('./lib/wa_detect');\n\n      var DEFAULT_OPTIONS = {\n        js: true,\n        wasm: true\n      };\n\n      function MultiMath(options) {\n        if (!(this instanceof MultiMath)) return new MultiMath(options);\n        var opts = assign({}, DEFAULT_OPTIONS, options || {});\n        this.options = opts;\n        this.__cache = {};\n        this.__init_promise = null;\n        this.__modules = opts.modules || {};\n        this.__memory = null;\n        this.__wasm = {};\n        this.__isLE = new Uint32Array(new Uint8Array([1, 0, 0, 0]).buffer)[0] === 1;\n\n        if (!this.options.js && !this.options.wasm) {\n          throw new Error('mathlib: at least \"js\" or \"wasm\" should be enabled');\n        }\n      }\n\n      MultiMath.prototype.has_wasm = hasWebAssembly;\n\n      MultiMath.prototype.use = function (module) {\n        this.__modules[module.name] = module; // Pin the best possible implementation\n\n        if (this.options.wasm && this.has_wasm() && module.wasm_fn) {\n          this[module.name] = module.wasm_fn;\n        } else {\n          this[module.name] = module.fn;\n        }\n\n        return this;\n      };\n\n      MultiMath.prototype.init = function () {\n        if (this.__init_promise) return this.__init_promise;\n\n        if (!this.options.js && this.options.wasm && !this.has_wasm()) {\n          return Promise.reject(new Error('mathlib: only \"wasm\" was enabled, but it\\'s not supported'));\n        }\n\n        var self = this;\n        this.__init_promise = Promise.all(Object.keys(self.__modules).map(function (name) {\n          var module = self.__modules[name];\n          if (!self.options.wasm || !self.has_wasm() || !module.wasm_fn) return null; // If already compiled - exit\n\n          if (self.__wasm[name]) return null; // Compile wasm source\n\n          return WebAssembly.compile(self.__base64decode(module.wasm_src)).then(function (m) {\n            self.__wasm[name] = m;\n          });\n        })).then(function () {\n          return self;\n        });\n        return this.__init_promise;\n      }; ////////////////////////////////////////////////////////////////////////////////\n      // Methods below are for internal use from plugins\n      // Simple decode base64 to typed array. Useful to load embedded webassembly\n      // code. You probably don't need to call this method directly.\n      //\n\n\n      MultiMath.prototype.__base64decode = base64decode; // Increase current memory to include specified number of bytes. Do nothing if\n      // size is already ok. You probably don't need to call this method directly,\n      // because it will be invoked from `.__instance()`.\n      //\n\n      MultiMath.prototype.__reallocate = function mem_grow_to(bytes) {\n        if (!this.__memory) {\n          this.__memory = new WebAssembly.Memory({\n            initial: Math.ceil(bytes / (64 * 1024))\n          });\n          return this.__memory;\n        }\n\n        var mem_size = this.__memory.buffer.byteLength;\n\n        if (mem_size < bytes) {\n          this.__memory.grow(Math.ceil((bytes - mem_size) / (64 * 1024)));\n        }\n\n        return this.__memory;\n      }; // Returns instantinated webassembly item by name, with specified memory size\n      // and environment.\n      // - use cache if available\n      // - do sync module init, if async init was not called earlier\n      // - allocate memory if not enougth\n      // - can export functions to webassembly via \"env_extra\",\n      //   for example, { exp: Math.exp }\n      //\n\n\n      MultiMath.prototype.__instance = function instance(name, memsize, env_extra) {\n        if (memsize) this.__reallocate(memsize); // If .init() was not called, do sync compile\n\n        if (!this.__wasm[name]) {\n          var module = this.__modules[name];\n          this.__wasm[name] = new WebAssembly.Module(this.__base64decode(module.wasm_src));\n        }\n\n        if (!this.__cache[name]) {\n          var env_base = {\n            memoryBase: 0,\n            memory: this.__memory,\n            tableBase: 0,\n            table: new WebAssembly.Table({\n              initial: 0,\n              element: 'anyfunc'\n            })\n          };\n          this.__cache[name] = new WebAssembly.Instance(this.__wasm[name], {\n            env: assign(env_base, env_extra || {})\n          });\n        }\n\n        return this.__cache[name];\n      }; // Helper to calculate memory aligh for pointers. Webassembly does not require\n      // this, but you may wish to experiment. Default base = 8;\n      //\n\n\n      MultiMath.prototype.__align = function align(number, base) {\n        base = base || 8;\n        var reminder = number % base;\n        return number + (reminder ? base - reminder : 0);\n      };\n\n      module.exports = MultiMath;\n    }, {\n      \"./lib/base64decode\": 21,\n      \"./lib/wa_detect\": 22,\n      \"object-assign\": 23\n    }],\n    21: [function (_dereq_, module, exports) {\n      // base64 decode str -> Uint8Array, to load WA modules\n      //\n      'use strict';\n\n      var BASE64_MAP = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n\n      module.exports = function base64decode(str) {\n        var input = str.replace(/[\\r\\n=]/g, ''),\n            // remove CR/LF & padding to simplify scan\n        max = input.length;\n        var out = new Uint8Array(max * 3 >> 2); // Collect by 6*4 bits (3 bytes)\n\n        var bits = 0;\n        var ptr = 0;\n\n        for (var idx = 0; idx < max; idx++) {\n          if (idx % 4 === 0 && idx) {\n            out[ptr++] = bits >> 16 & 0xFF;\n            out[ptr++] = bits >> 8 & 0xFF;\n            out[ptr++] = bits & 0xFF;\n          }\n\n          bits = bits << 6 | BASE64_MAP.indexOf(input.charAt(idx));\n        } // Dump tail\n\n\n        var tailbits = max % 4 * 6;\n\n        if (tailbits === 0) {\n          out[ptr++] = bits >> 16 & 0xFF;\n          out[ptr++] = bits >> 8 & 0xFF;\n          out[ptr++] = bits & 0xFF;\n        } else if (tailbits === 18) {\n          out[ptr++] = bits >> 10 & 0xFF;\n          out[ptr++] = bits >> 2 & 0xFF;\n        } else if (tailbits === 12) {\n          out[ptr++] = bits >> 4 & 0xFF;\n        }\n\n        return out;\n      };\n    }, {}],\n    22: [function (_dereq_, module, exports) {\n      // Detect WebAssembly support.\n      // - Check global WebAssembly object\n      // - Try to load simple module (can be disabled via CSP)\n      //\n      'use strict';\n\n      var wa;\n\n      module.exports = function hasWebAssembly() {\n        // use cache if called before;\n        if (typeof wa !== 'undefined') return wa;\n        wa = false;\n        if (typeof WebAssembly === 'undefined') return wa; // If WebAssenbly is disabled, code can throw on compile\n\n        try {\n          // https://github.com/brion/min-wasm-fail/blob/master/min-wasm-fail.in.js\n          // Additional check that WA internals are correct\n\n          /* eslint-disable comma-spacing, max-len */\n          var bin = new Uint8Array([0, 97, 115, 109, 1, 0, 0, 0, 1, 6, 1, 96, 1, 127, 1, 127, 3, 2, 1, 0, 5, 3, 1, 0, 1, 7, 8, 1, 4, 116, 101, 115, 116, 0, 0, 10, 16, 1, 14, 0, 32, 0, 65, 1, 54, 2, 0, 32, 0, 40, 2, 0, 11]);\n          var module = new WebAssembly.Module(bin);\n          var instance = new WebAssembly.Instance(module, {}); // test storing to and loading from a non-zero location via a parameter.\n          // Safari on iOS 11.2.5 returns 0 unexpectedly at non-zero locations\n\n          if (instance.exports.test(4) !== 0) wa = true;\n          return wa;\n        } catch (__) {}\n\n        return wa;\n      };\n    }, {}],\n    23: [function (_dereq_, module, exports) {\n      /*\n      object-assign\n      (c) Sindre Sorhus\n      @license MIT\n      */\n      'use strict';\n      /* eslint-disable no-unused-vars */\n\n      var getOwnPropertySymbols = Object.getOwnPropertySymbols;\n      var hasOwnProperty = Object.prototype.hasOwnProperty;\n      var propIsEnumerable = Object.prototype.propertyIsEnumerable;\n\n      function toObject(val) {\n        if (val === null || val === undefined) {\n          throw new TypeError('Object.assign cannot be called with null or undefined');\n        }\n\n        return Object(val);\n      }\n\n      function shouldUseNative() {\n        try {\n          if (!Object.assign) {\n            return false;\n          } // Detect buggy property enumeration order in older V8 versions.\n          // https://bugs.chromium.org/p/v8/issues/detail?id=4118\n\n\n          var test1 = new String('abc'); // eslint-disable-line no-new-wrappers\n\n          test1[5] = 'de';\n\n          if (Object.getOwnPropertyNames(test1)[0] === '5') {\n            return false;\n          } // https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\n\n          var test2 = {};\n\n          for (var i = 0; i < 10; i++) {\n            test2['_' + String.fromCharCode(i)] = i;\n          }\n\n          var order2 = Object.getOwnPropertyNames(test2).map(function (n) {\n            return test2[n];\n          });\n\n          if (order2.join('') !== '0123456789') {\n            return false;\n          } // https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\n\n          var test3 = {};\n          'abcdefghijklmnopqrst'.split('').forEach(function (letter) {\n            test3[letter] = letter;\n          });\n\n          if (Object.keys(Object.assign({}, test3)).join('') !== 'abcdefghijklmnopqrst') {\n            return false;\n          }\n\n          return true;\n        } catch (err) {\n          // We don't expect any of the above to throw, but better to be safe.\n          return false;\n        }\n      }\n\n      module.exports = shouldUseNative() ? Object.assign : function (target, source) {\n        var from;\n        var to = toObject(target);\n        var symbols;\n\n        for (var s = 1; s < arguments.length; s++) {\n          from = Object(arguments[s]);\n\n          for (var key in from) {\n            if (hasOwnProperty.call(from, key)) {\n              to[key] = from[key];\n            }\n          }\n\n          if (getOwnPropertySymbols) {\n            symbols = getOwnPropertySymbols(from);\n\n            for (var i = 0; i < symbols.length; i++) {\n              if (propIsEnumerable.call(from, symbols[i])) {\n                to[symbols[i]] = from[symbols[i]];\n              }\n            }\n          }\n        }\n\n        return to;\n      };\n    }, {}],\n    24: [function (_dereq_, module, exports) {\n      var bundleFn = arguments[3];\n      var sources = arguments[4];\n      var cache = arguments[5];\n      var stringify = JSON.stringify;\n\n      module.exports = function (fn, options) {\n        var wkey;\n        var cacheKeys = Object.keys(cache);\n\n        for (var i = 0, l = cacheKeys.length; i < l; i++) {\n          var key = cacheKeys[i];\n          var exp = cache[key].exports; // Using babel as a transpiler to use esmodule, the export will always\n          // be an object with the default export as a property of it. To ensure\n          // the existing api and babel esmodule exports are both supported we\n          // check for both\n\n          if (exp === fn || exp && exp.default === fn) {\n            wkey = key;\n            break;\n          }\n        }\n\n        if (!wkey) {\n          wkey = Math.floor(Math.pow(16, 8) * Math.random()).toString(16);\n          var wcache = {};\n\n          for (var i = 0, l = cacheKeys.length; i < l; i++) {\n            var key = cacheKeys[i];\n            wcache[key] = key;\n          }\n\n          sources[wkey] = ['function(require,module,exports){' + fn + '(self); }', wcache];\n        }\n\n        var skey = Math.floor(Math.pow(16, 8) * Math.random()).toString(16);\n        var scache = {};\n        scache[wkey] = wkey;\n        sources[skey] = ['function(require,module,exports){' + // try to call default if defined to also support babel esmodule exports\n        'var f = require(' + stringify(wkey) + ');' + '(f.default ? f.default : f)(self);' + '}', scache];\n        var workerSources = {};\n        resolveSources(skey);\n\n        function resolveSources(key) {\n          workerSources[key] = true;\n\n          for (var depPath in sources[key][1]) {\n            var depKey = sources[key][1][depPath];\n\n            if (!workerSources[depKey]) {\n              resolveSources(depKey);\n            }\n          }\n        }\n\n        var src = '(' + bundleFn + ')({' + Object.keys(workerSources).map(function (key) {\n          return stringify(key) + ':[' + sources[key][0] + ',' + stringify(sources[key][1]) + ']';\n        }).join(',') + '},{},[' + stringify(skey) + '])';\n        var URL = window.URL || window.webkitURL || window.mozURL || window.msURL;\n        var blob = new Blob([src], {\n          type: 'text/javascript'\n        });\n\n        if (options && options.bare) {\n          return blob;\n        }\n\n        var workerUrl = URL.createObjectURL(blob);\n        var worker = new Worker(workerUrl);\n        worker.objectURL = workerUrl;\n        return worker;\n      };\n    }, {}],\n    \"/index.js\": [function (_dereq_, module, exports) {\n      'use strict';\n\n      function _slicedToArray(arr, i) {\n        return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n      }\n\n      function _nonIterableRest() {\n        throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n      }\n\n      function _unsupportedIterableToArray(o, minLen) {\n        if (!o) return;\n        if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n        var n = Object.prototype.toString.call(o).slice(8, -1);\n        if (n === \"Object\" && o.constructor) n = o.constructor.name;\n        if (n === \"Map\" || n === \"Set\") return Array.from(o);\n        if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n      }\n\n      function _arrayLikeToArray(arr, len) {\n        if (len == null || len > arr.length) len = arr.length;\n\n        for (var i = 0, arr2 = new Array(len); i < len; i++) {\n          arr2[i] = arr[i];\n        }\n\n        return arr2;\n      }\n\n      function _iterableToArrayLimit(arr, i) {\n        var _i = arr == null ? null : typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"];\n\n        if (_i == null) return;\n        var _arr = [];\n        var _n = true;\n        var _d = false;\n\n        var _s, _e;\n\n        try {\n          for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) {\n            _arr.push(_s.value);\n\n            if (i && _arr.length === i) break;\n          }\n        } catch (err) {\n          _d = true;\n          _e = err;\n        } finally {\n          try {\n            if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n          } finally {\n            if (_d) throw _e;\n          }\n        }\n\n        return _arr;\n      }\n\n      function _arrayWithHoles(arr) {\n        if (Array.isArray(arr)) return arr;\n      }\n\n      var assign = _dereq_('object-assign');\n\n      var webworkify = _dereq_('webworkify');\n\n      var MathLib = _dereq_('./lib/mathlib');\n\n      var Pool = _dereq_('./lib/pool');\n\n      var utils = _dereq_('./lib/utils');\n\n      var worker = _dereq_('./lib/worker');\n\n      var createStages = _dereq_('./lib/stepper');\n\n      var createRegions = _dereq_('./lib/tiler'); // Deduplicate pools & limiters with the same configs\n      // when user creates multiple pica instances.\n\n\n      var singletones = {};\n      var NEED_SAFARI_FIX = false;\n\n      try {\n        if (typeof navigator !== 'undefined' && navigator.userAgent) {\n          NEED_SAFARI_FIX = navigator.userAgent.indexOf('Safari') >= 0;\n        }\n      } catch (e) {}\n\n      var concurrency = 1;\n\n      if (typeof navigator !== 'undefined') {\n        concurrency = Math.min(navigator.hardwareConcurrency || 1, 4);\n      }\n\n      var DEFAULT_PICA_OPTS = {\n        tile: 1024,\n        concurrency: concurrency,\n        features: ['js', 'wasm', 'ww'],\n        idle: 2000,\n        createCanvas: function createCanvas(width, height) {\n          var tmpCanvas = document.createElement('canvas');\n          tmpCanvas.width = width;\n          tmpCanvas.height = height;\n          return tmpCanvas;\n        }\n      };\n      var DEFAULT_RESIZE_OPTS = {\n        quality: 3,\n        alpha: false,\n        unsharpAmount: 0,\n        unsharpRadius: 0.0,\n        unsharpThreshold: 0\n      };\n      var CAN_NEW_IMAGE_DATA = false;\n      var CAN_CREATE_IMAGE_BITMAP = false;\n      var CAN_USE_CANVAS_GET_IMAGE_DATA = false;\n      var CAN_USE_OFFSCREEN_CANVAS = false;\n      var CAN_USE_CIB_REGION_FOR_IMAGE = false;\n\n      function workerFabric() {\n        return {\n          value: webworkify(worker),\n          destroy: function destroy() {\n            this.value.terminate();\n\n            if (typeof window !== 'undefined') {\n              var url = window.URL || window.webkitURL || window.mozURL || window.msURL;\n\n              if (url && url.revokeObjectURL && this.value.objectURL) {\n                url.revokeObjectURL(this.value.objectURL);\n              }\n            }\n          }\n        };\n      } ////////////////////////////////////////////////////////////////////////////////\n      // API methods\n\n\n      function Pica(options) {\n        if (!(this instanceof Pica)) return new Pica(options);\n        this.options = assign({}, DEFAULT_PICA_OPTS, options || {});\n        var limiter_key = \"lk_\".concat(this.options.concurrency); // Share limiters to avoid multiple parallel workers when user creates\n        // multiple pica instances.\n\n        this.__limit = singletones[limiter_key] || utils.limiter(this.options.concurrency);\n        if (!singletones[limiter_key]) singletones[limiter_key] = this.__limit; // List of supported features, according to options & browser/node.js\n\n        this.features = {\n          js: false,\n          // pure JS implementation, can be disabled for testing\n          wasm: false,\n          // webassembly implementation for heavy functions\n          cib: false,\n          // resize via createImageBitmap (only FF at this moment)\n          ww: false // webworkers\n\n        };\n        this.__workersPool = null; // Store requested features for webworkers\n\n        this.__requested_features = [];\n        this.__mathlib = null;\n      }\n\n      Pica.prototype.init = function () {\n        var _this = this;\n\n        if (this.__initPromise) return this.__initPromise; // Test if we can create ImageData without canvas and memory copy\n\n        if (typeof ImageData !== 'undefined' && typeof Uint8ClampedArray !== 'undefined') {\n          try {\n            /* eslint-disable no-new */\n            new ImageData(new Uint8ClampedArray(400), 10, 10);\n            CAN_NEW_IMAGE_DATA = true;\n          } catch (__) {}\n        } // ImageBitmap can be effective in 2 places:\n        //\n        // 1. Threaded jpeg unpack (basic)\n        // 2. Built-in resize (blocked due problem in chrome, see issue #89)\n        //\n        // For basic use we also need ImageBitmap wo support .close() method,\n        // see https://developer.mozilla.org/ru/docs/Web/API/ImageBitmap\n\n\n        if (typeof ImageBitmap !== 'undefined') {\n          if (ImageBitmap.prototype && ImageBitmap.prototype.close) {\n            CAN_CREATE_IMAGE_BITMAP = true;\n          } else {\n            this.debug('ImageBitmap does not support .close(), disabled');\n          }\n        }\n\n        var features = this.options.features.slice();\n\n        if (features.indexOf('all') >= 0) {\n          features = ['cib', 'wasm', 'js', 'ww'];\n        }\n\n        this.__requested_features = features;\n        this.__mathlib = new MathLib(features); // Check WebWorker support if requested\n\n        if (features.indexOf('ww') >= 0) {\n          if (typeof window !== 'undefined' && 'Worker' in window) {\n            // IE <= 11 don't allow to create webworkers from string. We should check it.\n            // https://connect.microsoft.com/IE/feedback/details/801810/web-workers-from-blob-urls-in-ie-10-and-11\n            try {\n              var wkr = _dereq_('webworkify')(function () {});\n\n              wkr.terminate();\n              this.features.ww = true; // pool uniqueness depends on pool config + webworker config\n\n              var wpool_key = \"wp_\".concat(JSON.stringify(this.options));\n\n              if (singletones[wpool_key]) {\n                this.__workersPool = singletones[wpool_key];\n              } else {\n                this.__workersPool = new Pool(workerFabric, this.options.idle);\n                singletones[wpool_key] = this.__workersPool;\n              }\n            } catch (__) {}\n          }\n        }\n\n        var initMath = this.__mathlib.init().then(function (mathlib) {\n          // Copy detected features\n          assign(_this.features, mathlib.features);\n        });\n\n        var checkCibResize;\n\n        if (!CAN_CREATE_IMAGE_BITMAP) {\n          checkCibResize = Promise.resolve(false);\n        } else {\n          checkCibResize = utils.cib_support(this.options.createCanvas).then(function (status) {\n            if (_this.features.cib && features.indexOf('cib') < 0) {\n              _this.debug('createImageBitmap() resize supported, but disabled by config');\n\n              return;\n            }\n\n            if (features.indexOf('cib') >= 0) _this.features.cib = status;\n          });\n        }\n\n        CAN_USE_CANVAS_GET_IMAGE_DATA = utils.can_use_canvas(this.options.createCanvas);\n        var checkOffscreenCanvas;\n\n        if (CAN_CREATE_IMAGE_BITMAP && CAN_NEW_IMAGE_DATA && features.indexOf('ww') !== -1) {\n          checkOffscreenCanvas = utils.worker_offscreen_canvas_support();\n        } else {\n          checkOffscreenCanvas = Promise.resolve(false);\n        }\n\n        checkOffscreenCanvas = checkOffscreenCanvas.then(function (result) {\n          CAN_USE_OFFSCREEN_CANVAS = result;\n        }); // we use createImageBitmap to crop image data and pass it to workers,\n        // so need to check whether function works correctly;\n        // https://bugs.chromium.org/p/chromium/issues/detail?id=1220671\n\n        var checkCibRegion = utils.cib_can_use_region().then(function (result) {\n          CAN_USE_CIB_REGION_FOR_IMAGE = result;\n        }); // Init math lib. That's async because can load some\n\n        this.__initPromise = Promise.all([initMath, checkCibResize, checkOffscreenCanvas, checkCibRegion]).then(function () {\n          return _this;\n        });\n        return this.__initPromise;\n      }; // Call resizer in webworker or locally, depending on config\n\n\n      Pica.prototype.__invokeResize = function (tileOpts, opts) {\n        var _this2 = this; // Share cache between calls:\n        //\n        // - wasm instance\n        // - wasm memory object\n        //\n\n\n        opts.__mathCache = opts.__mathCache || {};\n        return Promise.resolve().then(function () {\n          if (!_this2.features.ww) {\n            // not possible to have ImageBitmap here if user disabled WW\n            return {\n              data: _this2.__mathlib.resizeAndUnsharp(tileOpts, opts.__mathCache)\n            };\n          }\n\n          return new Promise(function (resolve, reject) {\n            var w = _this2.__workersPool.acquire();\n\n            if (opts.cancelToken) opts.cancelToken[\"catch\"](function (err) {\n              return reject(err);\n            });\n\n            w.value.onmessage = function (ev) {\n              w.release();\n              if (ev.data.err) reject(ev.data.err);else resolve(ev.data);\n            };\n\n            var transfer = [];\n            if (tileOpts.src) transfer.push(tileOpts.src.buffer);\n            if (tileOpts.srcBitmap) transfer.push(tileOpts.srcBitmap);\n            w.value.postMessage({\n              opts: tileOpts,\n              features: _this2.__requested_features,\n              preload: {\n                wasm_nodule: _this2.__mathlib.__\n              }\n            }, transfer);\n          });\n        });\n      }; // this function can return promise if createImageBitmap is used\n\n\n      Pica.prototype.__extractTileData = function (tile, from, opts, stageEnv, extractTo) {\n        if (this.features.ww && CAN_USE_OFFSCREEN_CANVAS && ( // createImageBitmap doesn't work for images (Image, ImageBitmap) with Exif orientation in Chrome,\n        // can use canvas because canvas doesn't have orientation;\n        // see https://bugs.chromium.org/p/chromium/issues/detail?id=1220671\n        utils.isCanvas(from) || CAN_USE_CIB_REGION_FOR_IMAGE)) {\n          this.debug('Create tile for OffscreenCanvas');\n          return createImageBitmap(stageEnv.srcImageBitmap || from, tile.x, tile.y, tile.width, tile.height).then(function (bitmap) {\n            extractTo.srcBitmap = bitmap;\n            return extractTo;\n          });\n        } // Extract tile RGBA buffer, depending on input type\n\n\n        if (utils.isCanvas(from)) {\n          if (!stageEnv.srcCtx) stageEnv.srcCtx = from.getContext('2d', {\n            alpha: Boolean(opts.alpha)\n          }); // If input is Canvas - extract region data directly\n\n          this.debug('Get tile pixel data');\n          extractTo.src = stageEnv.srcCtx.getImageData(tile.x, tile.y, tile.width, tile.height).data;\n          return extractTo;\n        } // If input is Image or decoded to ImageBitmap,\n        // draw region to temporary canvas and extract data from it\n        //\n        // Note! Attempt to reuse this canvas causes significant slowdown in chrome\n        //\n\n\n        this.debug('Draw tile imageBitmap/image to temporary canvas');\n        var tmpCanvas = this.options.createCanvas(tile.width, tile.height);\n        var tmpCtx = tmpCanvas.getContext('2d', {\n          alpha: Boolean(opts.alpha)\n        });\n        tmpCtx.globalCompositeOperation = 'copy';\n        tmpCtx.drawImage(stageEnv.srcImageBitmap || from, tile.x, tile.y, tile.width, tile.height, 0, 0, tile.width, tile.height);\n        this.debug('Get tile pixel data');\n        extractTo.src = tmpCtx.getImageData(0, 0, tile.width, tile.height).data; // Safari 12 workaround\n        // https://github.com/nodeca/pica/issues/199\n\n        tmpCanvas.width = tmpCanvas.height = 0;\n        return extractTo;\n      };\n\n      Pica.prototype.__landTileData = function (tile, result, stageEnv) {\n        var toImageData;\n        this.debug('Convert raw rgba tile result to ImageData');\n\n        if (result.bitmap) {\n          stageEnv.toCtx.drawImage(result.bitmap, tile.toX, tile.toY);\n          return null;\n        }\n\n        if (CAN_NEW_IMAGE_DATA) {\n          // this branch is for modern browsers\n          // If `new ImageData()` & Uint8ClampedArray suported\n          toImageData = new ImageData(new Uint8ClampedArray(result.data), tile.toWidth, tile.toHeight);\n        } else {\n          // fallback for `node-canvas` and old browsers\n          // (IE11 has ImageData but does not support `new ImageData()`)\n          toImageData = stageEnv.toCtx.createImageData(tile.toWidth, tile.toHeight);\n\n          if (toImageData.data.set) {\n            toImageData.data.set(result.data);\n          } else {\n            // IE9 don't have `.set()`\n            for (var i = toImageData.data.length - 1; i >= 0; i--) {\n              toImageData.data[i] = result.data[i];\n            }\n          }\n        }\n\n        this.debug('Draw tile');\n\n        if (NEED_SAFARI_FIX) {\n          // Safari draws thin white stripes between tiles without this fix\n          stageEnv.toCtx.putImageData(toImageData, tile.toX, tile.toY, tile.toInnerX - tile.toX, tile.toInnerY - tile.toY, tile.toInnerWidth + 1e-5, tile.toInnerHeight + 1e-5);\n        } else {\n          stageEnv.toCtx.putImageData(toImageData, tile.toX, tile.toY, tile.toInnerX - tile.toX, tile.toInnerY - tile.toY, tile.toInnerWidth, tile.toInnerHeight);\n        }\n\n        return null;\n      };\n\n      Pica.prototype.__tileAndResize = function (from, to, opts) {\n        var _this3 = this;\n\n        var stageEnv = {\n          srcCtx: null,\n          srcImageBitmap: null,\n          isImageBitmapReused: false,\n          toCtx: null\n        };\n\n        var processTile = function processTile(tile) {\n          return _this3.__limit(function () {\n            if (opts.canceled) return opts.cancelToken;\n            var tileOpts = {\n              width: tile.width,\n              height: tile.height,\n              toWidth: tile.toWidth,\n              toHeight: tile.toHeight,\n              scaleX: tile.scaleX,\n              scaleY: tile.scaleY,\n              offsetX: tile.offsetX,\n              offsetY: tile.offsetY,\n              quality: opts.quality,\n              alpha: opts.alpha,\n              unsharpAmount: opts.unsharpAmount,\n              unsharpRadius: opts.unsharpRadius,\n              unsharpThreshold: opts.unsharpThreshold\n            };\n\n            _this3.debug('Invoke resize math');\n\n            return Promise.resolve(tileOpts).then(function (tileOpts) {\n              return _this3.__extractTileData(tile, from, opts, stageEnv, tileOpts);\n            }).then(function (tileOpts) {\n              _this3.debug('Invoke resize math');\n\n              return _this3.__invokeResize(tileOpts, opts);\n            }).then(function (result) {\n              if (opts.canceled) return opts.cancelToken;\n              stageEnv.srcImageData = null;\n              return _this3.__landTileData(tile, result, stageEnv);\n            });\n          });\n        }; // Need to normalize data source first. It can be canvas or image.\n        // If image - try to decode in background if possible\n\n\n        return Promise.resolve().then(function () {\n          stageEnv.toCtx = to.getContext('2d', {\n            alpha: Boolean(opts.alpha)\n          });\n          if (utils.isCanvas(from)) return null;\n\n          if (utils.isImageBitmap(from)) {\n            stageEnv.srcImageBitmap = from;\n            stageEnv.isImageBitmapReused = true;\n            return null;\n          }\n\n          if (utils.isImage(from)) {\n            // try do decode image in background for faster next operations;\n            // if we're using offscreen canvas, cib is called per tile, so not needed here\n            if (!CAN_CREATE_IMAGE_BITMAP) return null;\n\n            _this3.debug('Decode image via createImageBitmap');\n\n            return createImageBitmap(from).then(function (imageBitmap) {\n              stageEnv.srcImageBitmap = imageBitmap;\n            }) // Suppress error to use fallback, if method fails\n            // https://github.com/nodeca/pica/issues/190\n\n            /* eslint-disable no-unused-vars */\n            [\"catch\"](function (e) {\n              return null;\n            });\n          }\n\n          throw new Error('Pica: \".from\" should be Image, Canvas or ImageBitmap');\n        }).then(function () {\n          if (opts.canceled) return opts.cancelToken;\n\n          _this3.debug('Calculate tiles'); //\n          // Here we are with \"normalized\" source,\n          // follow to tiling\n          //\n\n\n          var regions = createRegions({\n            width: opts.width,\n            height: opts.height,\n            srcTileSize: _this3.options.tile,\n            toWidth: opts.toWidth,\n            toHeight: opts.toHeight,\n            destTileBorder: opts.__destTileBorder\n          });\n          var jobs = regions.map(function (tile) {\n            return processTile(tile);\n          });\n\n          function cleanup(stageEnv) {\n            if (stageEnv.srcImageBitmap) {\n              if (!stageEnv.isImageBitmapReused) stageEnv.srcImageBitmap.close();\n              stageEnv.srcImageBitmap = null;\n            }\n          }\n\n          _this3.debug('Process tiles');\n\n          return Promise.all(jobs).then(function () {\n            _this3.debug('Finished!');\n\n            cleanup(stageEnv);\n            return to;\n          }, function (err) {\n            cleanup(stageEnv);\n            throw err;\n          });\n        });\n      };\n\n      Pica.prototype.__processStages = function (stages, from, to, opts) {\n        var _this4 = this;\n\n        if (opts.canceled) return opts.cancelToken;\n\n        var _stages$shift = stages.shift(),\n            _stages$shift2 = _slicedToArray(_stages$shift, 2),\n            toWidth = _stages$shift2[0],\n            toHeight = _stages$shift2[1];\n\n        var isLastStage = stages.length === 0;\n        opts = assign({}, opts, {\n          toWidth: toWidth,\n          toHeight: toHeight,\n          // only use user-defined quality for the last stage,\n          // use simpler (Hamming) filter for the first stages where\n          // scale factor is large enough (more than 2-3)\n          quality: isLastStage ? opts.quality : Math.min(1, opts.quality)\n        });\n        var tmpCanvas;\n\n        if (!isLastStage) {\n          // create temporary canvas\n          tmpCanvas = this.options.createCanvas(toWidth, toHeight);\n        }\n\n        return this.__tileAndResize(from, isLastStage ? to : tmpCanvas, opts).then(function () {\n          if (isLastStage) return to;\n          opts.width = toWidth;\n          opts.height = toHeight;\n          return _this4.__processStages(stages, tmpCanvas, to, opts);\n        }).then(function (res) {\n          if (tmpCanvas) {\n            // Safari 12 workaround\n            // https://github.com/nodeca/pica/issues/199\n            tmpCanvas.width = tmpCanvas.height = 0;\n          }\n\n          return res;\n        });\n      };\n\n      Pica.prototype.__resizeViaCreateImageBitmap = function (from, to, opts) {\n        var _this5 = this;\n\n        var toCtx = to.getContext('2d', {\n          alpha: Boolean(opts.alpha)\n        });\n        this.debug('Resize via createImageBitmap()');\n        return createImageBitmap(from, {\n          resizeWidth: opts.toWidth,\n          resizeHeight: opts.toHeight,\n          resizeQuality: utils.cib_quality_name(opts.quality)\n        }).then(function (imageBitmap) {\n          if (opts.canceled) return opts.cancelToken; // if no unsharp - draw directly to output canvas\n\n          if (!opts.unsharpAmount) {\n            toCtx.drawImage(imageBitmap, 0, 0);\n            imageBitmap.close();\n            toCtx = null;\n\n            _this5.debug('Finished!');\n\n            return to;\n          }\n\n          _this5.debug('Unsharp result');\n\n          var tmpCanvas = _this5.options.createCanvas(opts.toWidth, opts.toHeight);\n\n          var tmpCtx = tmpCanvas.getContext('2d', {\n            alpha: Boolean(opts.alpha)\n          });\n          tmpCtx.drawImage(imageBitmap, 0, 0);\n          imageBitmap.close();\n          var iData = tmpCtx.getImageData(0, 0, opts.toWidth, opts.toHeight);\n\n          _this5.__mathlib.unsharp_mask(iData.data, opts.toWidth, opts.toHeight, opts.unsharpAmount, opts.unsharpRadius, opts.unsharpThreshold);\n\n          toCtx.putImageData(iData, 0, 0); // Safari 12 workaround\n          // https://github.com/nodeca/pica/issues/199\n\n          tmpCanvas.width = tmpCanvas.height = 0;\n          iData = tmpCtx = tmpCanvas = toCtx = null;\n\n          _this5.debug('Finished!');\n\n          return to;\n        });\n      };\n\n      Pica.prototype.resize = function (from, to, options) {\n        var _this6 = this;\n\n        this.debug('Start resize...');\n        var opts = assign({}, DEFAULT_RESIZE_OPTS);\n\n        if (!isNaN(options)) {\n          opts = assign(opts, {\n            quality: options\n          });\n        } else if (options) {\n          opts = assign(opts, options);\n        }\n\n        opts.toWidth = to.width;\n        opts.toHeight = to.height;\n        opts.width = from.naturalWidth || from.width;\n        opts.height = from.naturalHeight || from.height; // Prevent stepper from infinite loop\n\n        if (to.width === 0 || to.height === 0) {\n          return Promise.reject(new Error(\"Invalid output size: \".concat(to.width, \"x\").concat(to.height)));\n        }\n\n        if (opts.unsharpRadius > 2) opts.unsharpRadius = 2;\n        opts.canceled = false;\n\n        if (opts.cancelToken) {\n          // Wrap cancelToken to avoid successive resolve & set flag\n          opts.cancelToken = opts.cancelToken.then(function (data) {\n            opts.canceled = true;\n            throw data;\n          }, function (err) {\n            opts.canceled = true;\n            throw err;\n          });\n        }\n\n        var DEST_TILE_BORDER = 3; // Max possible filter window size\n\n        opts.__destTileBorder = Math.ceil(Math.max(DEST_TILE_BORDER, 2.5 * opts.unsharpRadius | 0));\n        return this.init().then(function () {\n          if (opts.canceled) return opts.cancelToken; // if createImageBitmap supports resize, just do it and return\n\n          if (_this6.features.cib) {\n            return _this6.__resizeViaCreateImageBitmap(from, to, opts);\n          }\n\n          if (!CAN_USE_CANVAS_GET_IMAGE_DATA) {\n            var err = new Error('Pica: cannot use getImageData on canvas, ' + \"make sure fingerprinting protection isn't enabled\");\n            err.code = 'ERR_GET_IMAGE_DATA';\n            throw err;\n          } //\n          // No easy way, let's resize manually via arrays\n          //\n\n\n          var stages = createStages(opts.width, opts.height, opts.toWidth, opts.toHeight, _this6.options.tile, opts.__destTileBorder);\n          return _this6.__processStages(stages, from, to, opts);\n        });\n      }; // RGBA buffer resize\n      //\n\n\n      Pica.prototype.resizeBuffer = function (options) {\n        var _this7 = this;\n\n        var opts = assign({}, DEFAULT_RESIZE_OPTS, options);\n        return this.init().then(function () {\n          return _this7.__mathlib.resizeAndUnsharp(opts);\n        });\n      };\n\n      Pica.prototype.toBlob = function (canvas, mimeType, quality) {\n        mimeType = mimeType || 'image/png';\n        return new Promise(function (resolve) {\n          if (canvas.toBlob) {\n            canvas.toBlob(function (blob) {\n              return resolve(blob);\n            }, mimeType, quality);\n            return;\n          }\n\n          if (canvas.convertToBlob) {\n            resolve(canvas.convertToBlob({\n              type: mimeType,\n              quality: quality\n            }));\n            return;\n          } // Fallback for old browsers\n\n\n          var asString = atob(canvas.toDataURL(mimeType, quality).split(',')[1]);\n          var len = asString.length;\n          var asBuffer = new Uint8Array(len);\n\n          for (var i = 0; i < len; i++) {\n            asBuffer[i] = asString.charCodeAt(i);\n          }\n\n          resolve(new Blob([asBuffer], {\n            type: mimeType\n          }));\n        });\n      };\n\n      Pica.prototype.debug = function () {};\n\n      module.exports = Pica;\n    }, {\n      \"./lib/mathlib\": 1,\n      \"./lib/pool\": 13,\n      \"./lib/stepper\": 14,\n      \"./lib/tiler\": 15,\n      \"./lib/utils\": 16,\n      \"./lib/worker\": 17,\n      \"object-assign\": 23,\n      \"webworkify\": 24\n    }]\n  }, {}, [])(\"/index.js\");\n});","map":{"version":3,"sources":["/Users/zahangiralam/Desktop/Projects/Others/kona-sl/kona-sl-frontend/node_modules/pica/dist/pica.js"],"names":["f","exports","module","define","amd","g","window","global","self","pica","r","e","n","t","o","i","c","require","u","a","Error","code","p","call","length","_dereq_","inherits","Multimath","mm_unsharp_mask","mm_resize","MathLib","requested_features","__requested_features","features","js","indexOf","wasm","has_wasm","use","prototype","resizeAndUnsharp","options","cache","result","resize","unsharpAmount","unsharp_mask","toWidth","toHeight","unsharpRadius","unsharpThreshold","clampTo8","convolveHorizontally","src","dest","srcW","srcH","destW","filters","b","filterPtr","filterShift","filterSize","srcPtr","srcY","destX","filterVal","srcOffset","destOffset","convolveVertically","name","fn","wasm_fn","wasm_src","createFilters","resetAlpha","dst","width","height","ptr","len","destH","scaleX","scaleY","offsetX","offsetY","Uint8Array","quality","alpha","filtersX","filtersY","tmp","FILTER_INFO","FIXED_FRAC_BITS","toFixedPoint","num","Math","round","resizeFilterGen","srcSize","destSize","scale","offset","filterFunction","filter","scaleInverted","scaleClamped","min","srcWindow","win","destPixel","srcPixel","srcFirst","srcLast","filterElementSize","floatFilter","fxpFilter","total","pxl","idx","floatVal","filterTotal","leftNotEmpty","rightNotEmpty","maxFilterElementSize","floor","packedFilter","Int16Array","packedFilterPtr","slowCopy","subarray","set","max","ceil","Float32Array","x","xpi","PI","sin","cos","asUint8Array","buffer","byteLength","IS_LE","Uint32Array","__","copyInt16asLE","target","target_offset","data","resize_wasm","src_offset","tmp_offset","__align","filtersX_offset","filtersY_offset","alloc_bytes","instance","__instance","mem","__memory","mem32","src32","convolveHV","_convolveHV","dest32","glur_mono16","hsv_v16","img","size","out","Uint16Array","unsharp","amount","radius","threshold","v1","v2","vmul","diff","iTimes4","brightness","blured","amountFp","thresholdFp","abs","pixels","img_bytes_cnt","hsv_bytes_cnt","blur_bytes_cnt","blur_line_byte_cnt","blur_coeffs_byte_cnt","img_offset","hsv_offset","blur_offset","blur_tmp_offset","blur_line_offset","blur_coeffs_offset","exp","img32","_hsv_v16","blurMono16","_blurMono16","_unsharp","GC_INTERVAL","Pool","create","idle","available","acquired","lastId","timeoutId","acquire","_this","resource","pop","id","release","_this2","lastUsed","Date","now","push","setTimeout","gc","_this3","destroy","MIN_INNER_TILE_SIZE","createStages","fromWidth","fromHeight","srcTileSize","destTileBorder","minScale","stageCount","log","pow","PIXEL_EPSILON","pixelFloor","nearest","pixelCeil","createRegions","innerTileWidth","innerTileHeight","y","innerX","innerY","toTileWidth","toTileHeight","tiles","tile","toX","toY","toInnerX","toInnerY","toInnerWidth","toInnerHeight","objClass","obj","Object","toString","isCanvas","element","cname","isImage","isImageBitmap","limiter","concurrency","active","queue","roll","shift","limit","Promise","resolve","reject","then","err","cib_quality_name","cib_support","createCanvas","createImageBitmap","resizeWidth","resizeHeight","resizeQuality","bitmap","status","close","worker_offscreen_canvas_support","OffscreenCanvas","workerPayload","postMessage","canvas","ctx","getContext","rect","btoa","concat","w","Worker","onmessage","ev","onerror","can_use_canvas","usable","d","createImageData","putImageData","getImageData","cib_can_use_region","image","Image","onload","mathLib","tileOpts","opts","returnBitmap","srcBitmap","Boolean","drawImage","toImageData","ImageData","Uint8ClampedArray","_canvas","_ctx","a0","a1","a2","a3","b1","b2","left_corner","right_corner","gaussCoef","sigma","g1","g2","k","convolveMono16","line","coeff","prev_src","curr_src","curr_out","prev_out","prev_prev_out","src_index","out_index","line_index","j","coeff_a0","coeff_a1","coeff_b1","coeff_b2","tmp_line","ctor","superCtor","super_","constructor","value","enumerable","writable","configurable","TempCtor","assign","base64decode","hasWebAssembly","DEFAULT_OPTIONS","MultiMath","__cache","__init_promise","__modules","modules","__wasm","__isLE","init","all","keys","map","WebAssembly","compile","__base64decode","m","__reallocate","mem_grow_to","bytes","Memory","initial","mem_size","grow","memsize","env_extra","Module","env_base","memoryBase","memory","tableBase","table","Table","Instance","env","align","number","base","reminder","BASE64_MAP","str","input","replace","bits","charAt","tailbits","wa","bin","test","getOwnPropertySymbols","hasOwnProperty","propIsEnumerable","propertyIsEnumerable","toObject","val","undefined","TypeError","shouldUseNative","test1","String","getOwnPropertyNames","test2","fromCharCode","order2","join","test3","split","forEach","letter","source","from","to","symbols","s","arguments","key","bundleFn","sources","stringify","JSON","wkey","cacheKeys","l","default","random","wcache","skey","scache","workerSources","resolveSources","depPath","depKey","URL","webkitURL","mozURL","msURL","blob","Blob","type","bare","workerUrl","createObjectURL","worker","objectURL","_slicedToArray","arr","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","minLen","_arrayLikeToArray","slice","Array","arr2","_i","Symbol","iterator","_arr","_n","_d","_s","_e","next","done","isArray","webworkify","utils","singletones","NEED_SAFARI_FIX","navigator","userAgent","hardwareConcurrency","DEFAULT_PICA_OPTS","tmpCanvas","document","createElement","DEFAULT_RESIZE_OPTS","CAN_NEW_IMAGE_DATA","CAN_CREATE_IMAGE_BITMAP","CAN_USE_CANVAS_GET_IMAGE_DATA","CAN_USE_OFFSCREEN_CANVAS","CAN_USE_CIB_REGION_FOR_IMAGE","workerFabric","terminate","url","revokeObjectURL","Pica","limiter_key","__limit","cib","ww","__workersPool","__mathlib","__initPromise","ImageBitmap","debug","wkr","wpool_key","initMath","mathlib","checkCibResize","checkOffscreenCanvas","checkCibRegion","__invokeResize","__mathCache","cancelToken","transfer","preload","wasm_nodule","__extractTileData","stageEnv","extractTo","srcImageBitmap","srcCtx","tmpCtx","globalCompositeOperation","__landTileData","toCtx","__tileAndResize","isImageBitmapReused","processTile","canceled","srcImageData","imageBitmap","regions","__destTileBorder","jobs","cleanup","__processStages","stages","_this4","_stages$shift","_stages$shift2","isLastStage","res","__resizeViaCreateImageBitmap","_this5","iData","_this6","isNaN","naturalWidth","naturalHeight","DEST_TILE_BORDER","resizeBuffer","_this7","toBlob","mimeType","convertToBlob","asString","atob","toDataURL","asBuffer","charCodeAt"],"mappings":"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","sourcesContent":["/*!\n\npica\nhttps://github.com/nodeca/pica\n\n*/\n\n(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.pica = f()}})(function(){var define,module,exports;return (function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(_dereq_,module,exports){\n// Collection of math functions\n//\n// 1. Combine components together\n// 2. Has async init to load wasm modules\n//\n'use strict';\n\nvar inherits = _dereq_('inherits');\n\nvar Multimath = _dereq_('multimath');\n\nvar mm_unsharp_mask = _dereq_('./mm_unsharp_mask');\n\nvar mm_resize = _dereq_('./mm_resize');\n\nfunction MathLib(requested_features) {\n  var __requested_features = requested_features || [];\n\n  var features = {\n    js: __requested_features.indexOf('js') >= 0,\n    wasm: __requested_features.indexOf('wasm') >= 0\n  };\n  Multimath.call(this, features);\n  this.features = {\n    js: features.js,\n    wasm: features.wasm && this.has_wasm()\n  };\n  this.use(mm_unsharp_mask);\n  this.use(mm_resize);\n}\n\ninherits(MathLib, Multimath);\n\nMathLib.prototype.resizeAndUnsharp = function resizeAndUnsharp(options, cache) {\n  var result = this.resize(options, cache);\n\n  if (options.unsharpAmount) {\n    this.unsharp_mask(result, options.toWidth, options.toHeight, options.unsharpAmount, options.unsharpRadius, options.unsharpThreshold);\n  }\n\n  return result;\n};\n\nmodule.exports = MathLib;\n\n},{\"./mm_resize\":4,\"./mm_unsharp_mask\":9,\"inherits\":19,\"multimath\":20}],2:[function(_dereq_,module,exports){\n// Resize convolvers, pure JS implementation\n//\n'use strict'; // Precision of fixed FP values\n//var FIXED_FRAC_BITS = 14;\n\nfunction clampTo8(i) {\n  return i < 0 ? 0 : i > 255 ? 255 : i;\n} // Convolve image in horizontal directions and transpose output. In theory,\n// transpose allow:\n//\n// - use the same convolver for both passes (this fails due different\n//   types of input array and temporary buffer)\n// - making vertical pass by horisonltal lines inprove CPU cache use.\n//\n// But in real life this doesn't work :)\n//\n\n\nfunction convolveHorizontally(src, dest, srcW, srcH, destW, filters) {\n  var r, g, b, a;\n  var filterPtr, filterShift, filterSize;\n  var srcPtr, srcY, destX, filterVal;\n  var srcOffset = 0,\n      destOffset = 0; // For each row\n\n  for (srcY = 0; srcY < srcH; srcY++) {\n    filterPtr = 0; // Apply precomputed filters to each destination row point\n\n    for (destX = 0; destX < destW; destX++) {\n      // Get the filter that determines the current output pixel.\n      filterShift = filters[filterPtr++];\n      filterSize = filters[filterPtr++];\n      srcPtr = srcOffset + filterShift * 4 | 0;\n      r = g = b = a = 0; // Apply the filter to the row to get the destination pixel r, g, b, a\n\n      for (; filterSize > 0; filterSize--) {\n        filterVal = filters[filterPtr++]; // Use reverse order to workaround deopts in old v8 (node v.10)\n        // Big thanks to @mraleph (Vyacheslav Egorov) for the tip.\n\n        a = a + filterVal * src[srcPtr + 3] | 0;\n        b = b + filterVal * src[srcPtr + 2] | 0;\n        g = g + filterVal * src[srcPtr + 1] | 0;\n        r = r + filterVal * src[srcPtr] | 0;\n        srcPtr = srcPtr + 4 | 0;\n      } // Bring this value back in range. All of the filter scaling factors\n      // are in fixed point with FIXED_FRAC_BITS bits of fractional part.\n      //\n      // (!) Add 1/2 of value before clamping to get proper rounding. In other\n      // case brightness loss will be noticeable if you resize image with white\n      // border and place it on white background.\n      //\n\n\n      dest[destOffset + 3] = clampTo8(a + (1 << 13) >> 14\n      /*FIXED_FRAC_BITS*/\n      );\n      dest[destOffset + 2] = clampTo8(b + (1 << 13) >> 14\n      /*FIXED_FRAC_BITS*/\n      );\n      dest[destOffset + 1] = clampTo8(g + (1 << 13) >> 14\n      /*FIXED_FRAC_BITS*/\n      );\n      dest[destOffset] = clampTo8(r + (1 << 13) >> 14\n      /*FIXED_FRAC_BITS*/\n      );\n      destOffset = destOffset + srcH * 4 | 0;\n    }\n\n    destOffset = (srcY + 1) * 4 | 0;\n    srcOffset = (srcY + 1) * srcW * 4 | 0;\n  }\n} // Technically, convolvers are the same. But input array and temporary\n// buffer can be of different type (especially, in old browsers). So,\n// keep code in separate functions to avoid deoptimizations & speed loss.\n\n\nfunction convolveVertically(src, dest, srcW, srcH, destW, filters) {\n  var r, g, b, a;\n  var filterPtr, filterShift, filterSize;\n  var srcPtr, srcY, destX, filterVal;\n  var srcOffset = 0,\n      destOffset = 0; // For each row\n\n  for (srcY = 0; srcY < srcH; srcY++) {\n    filterPtr = 0; // Apply precomputed filters to each destination row point\n\n    for (destX = 0; destX < destW; destX++) {\n      // Get the filter that determines the current output pixel.\n      filterShift = filters[filterPtr++];\n      filterSize = filters[filterPtr++];\n      srcPtr = srcOffset + filterShift * 4 | 0;\n      r = g = b = a = 0; // Apply the filter to the row to get the destination pixel r, g, b, a\n\n      for (; filterSize > 0; filterSize--) {\n        filterVal = filters[filterPtr++]; // Use reverse order to workaround deopts in old v8 (node v.10)\n        // Big thanks to @mraleph (Vyacheslav Egorov) for the tip.\n\n        a = a + filterVal * src[srcPtr + 3] | 0;\n        b = b + filterVal * src[srcPtr + 2] | 0;\n        g = g + filterVal * src[srcPtr + 1] | 0;\n        r = r + filterVal * src[srcPtr] | 0;\n        srcPtr = srcPtr + 4 | 0;\n      } // Bring this value back in range. All of the filter scaling factors\n      // are in fixed point with FIXED_FRAC_BITS bits of fractional part.\n      //\n      // (!) Add 1/2 of value before clamping to get proper rounding. In other\n      // case brightness loss will be noticeable if you resize image with white\n      // border and place it on white background.\n      //\n\n\n      dest[destOffset + 3] = clampTo8(a + (1 << 13) >> 14\n      /*FIXED_FRAC_BITS*/\n      );\n      dest[destOffset + 2] = clampTo8(b + (1 << 13) >> 14\n      /*FIXED_FRAC_BITS*/\n      );\n      dest[destOffset + 1] = clampTo8(g + (1 << 13) >> 14\n      /*FIXED_FRAC_BITS*/\n      );\n      dest[destOffset] = clampTo8(r + (1 << 13) >> 14\n      /*FIXED_FRAC_BITS*/\n      );\n      destOffset = destOffset + srcH * 4 | 0;\n    }\n\n    destOffset = (srcY + 1) * 4 | 0;\n    srcOffset = (srcY + 1) * srcW * 4 | 0;\n  }\n}\n\nmodule.exports = {\n  convolveHorizontally: convolveHorizontally,\n  convolveVertically: convolveVertically\n};\n\n},{}],3:[function(_dereq_,module,exports){\n// This is autogenerated file from math.wasm, don't edit.\n//\n'use strict';\n/* eslint-disable max-len */\n\nmodule.exports = 'AGFzbQEAAAAADAZkeWxpbmsAAAAAAAEXA2AAAGAGf39/f39/AGAHf39/f39/fwACDwEDZW52Bm1lbW9yeQIAAAMEAwABAgYGAX8AQQALB1cFEV9fd2FzbV9jYWxsX2N0b3JzAAAIY29udm9sdmUAAQpjb252b2x2ZUhWAAIMX19kc29faGFuZGxlAwAYX193YXNtX2FwcGx5X2RhdGFfcmVsb2NzAAAK7AMDAwABC8YDAQ9/AkAgA0UNACAERQ0AA0AgDCENQQAhE0EAIQcDQCAHQQJqIQYCfyAHQQF0IAVqIgcuAQIiFEUEQEGAwAAhCEGAwAAhCUGAwAAhCkGAwAAhCyAGDAELIBIgBy4BAGohCEEAIQsgFCEHQQAhDiAGIQlBACEPQQAhEANAIAUgCUEBdGouAQAiESAAIAhBAnRqKAIAIgpBGHZsIBBqIRAgCkH/AXEgEWwgC2ohCyAKQRB2Qf8BcSARbCAPaiEPIApBCHZB/wFxIBFsIA5qIQ4gCEEBaiEIIAlBAWohCSAHQQFrIgcNAAsgC0GAQGshCCAOQYBAayEJIA9BgEBrIQogEEGAQGshCyAGIBRqCyEHIAEgDUECdGogCUEOdSIGQf8BIAZB/wFIGyIGQQAgBkEAShtBCHRBgP4DcSAKQQ51IgZB/wEgBkH/AUgbIgZBACAGQQBKG0EQdEGAgPwHcSALQQ51IgZB/wEgBkH/AUgbIgZBACAGQQBKG0EYdHJyIAhBDnUiBkH/ASAGQf8BSBsiBkEAIAZBAEobcjYCACADIA1qIQ0gE0EBaiITIARHDQALIAxBAWoiDCACbCESIAMgDEcNAAsLCx4AQQAgAiADIAQgBSAAEAEgAkEAIAQgBSAGIAEQAQs=';\n\n},{}],4:[function(_dereq_,module,exports){\n'use strict';\n\nmodule.exports = {\n  name: 'resize',\n  fn: _dereq_('./resize'),\n  wasm_fn: _dereq_('./resize_wasm'),\n  wasm_src: _dereq_('./convolve_wasm_base64')\n};\n\n},{\"./convolve_wasm_base64\":3,\"./resize\":5,\"./resize_wasm\":8}],5:[function(_dereq_,module,exports){\n'use strict';\n\nvar createFilters = _dereq_('./resize_filter_gen');\n\nvar convolveHorizontally = _dereq_('./convolve').convolveHorizontally;\n\nvar convolveVertically = _dereq_('./convolve').convolveVertically;\n\nfunction resetAlpha(dst, width, height) {\n  var ptr = 3,\n      len = width * height * 4 | 0;\n\n  while (ptr < len) {\n    dst[ptr] = 0xFF;\n    ptr = ptr + 4 | 0;\n  }\n}\n\nmodule.exports = function resize(options) {\n  var src = options.src;\n  var srcW = options.width;\n  var srcH = options.height;\n  var destW = options.toWidth;\n  var destH = options.toHeight;\n  var scaleX = options.scaleX || options.toWidth / options.width;\n  var scaleY = options.scaleY || options.toHeight / options.height;\n  var offsetX = options.offsetX || 0;\n  var offsetY = options.offsetY || 0;\n  var dest = options.dest || new Uint8Array(destW * destH * 4);\n  var quality = typeof options.quality === 'undefined' ? 3 : options.quality;\n  var alpha = options.alpha || false;\n  var filtersX = createFilters(quality, srcW, destW, scaleX, offsetX),\n      filtersY = createFilters(quality, srcH, destH, scaleY, offsetY);\n  var tmp = new Uint8Array(destW * srcH * 4); // To use single function we need src & tmp of the same type.\n  // But src can be CanvasPixelArray, and tmp - Uint8Array. So, keep\n  // vertical and horizontal passes separately to avoid deoptimization.\n\n  convolveHorizontally(src, tmp, srcW, srcH, destW, filtersX);\n  convolveVertically(tmp, dest, srcH, destW, destH, filtersY); // That's faster than doing checks in convolver.\n  // !!! Note, canvas data is not premultipled. We don't need other\n  // alpha corrections.\n\n  if (!alpha) resetAlpha(dest, destW, destH);\n  return dest;\n};\n\n},{\"./convolve\":2,\"./resize_filter_gen\":6}],6:[function(_dereq_,module,exports){\n// Calculate convolution filters for each destination point,\n// and pack data to Int16Array:\n//\n// [ shift, length, data..., shift2, length2, data..., ... ]\n//\n// - shift - offset in src image\n// - length - filter length (in src points)\n// - data - filter values sequence\n//\n'use strict';\n\nvar FILTER_INFO = _dereq_('./resize_filter_info'); // Precision of fixed FP values\n\n\nvar FIXED_FRAC_BITS = 14;\n\nfunction toFixedPoint(num) {\n  return Math.round(num * ((1 << FIXED_FRAC_BITS) - 1));\n}\n\nmodule.exports = function resizeFilterGen(quality, srcSize, destSize, scale, offset) {\n  var filterFunction = FILTER_INFO[quality].filter;\n  var scaleInverted = 1.0 / scale;\n  var scaleClamped = Math.min(1.0, scale); // For upscale\n  // Filter window (averaging interval), scaled to src image\n\n  var srcWindow = FILTER_INFO[quality].win / scaleClamped;\n  var destPixel, srcPixel, srcFirst, srcLast, filterElementSize, floatFilter, fxpFilter, total, pxl, idx, floatVal, filterTotal, filterVal;\n  var leftNotEmpty, rightNotEmpty, filterShift, filterSize;\n  var maxFilterElementSize = Math.floor((srcWindow + 1) * 2);\n  var packedFilter = new Int16Array((maxFilterElementSize + 2) * destSize);\n  var packedFilterPtr = 0;\n  var slowCopy = !packedFilter.subarray || !packedFilter.set; // For each destination pixel calculate source range and built filter values\n\n  for (destPixel = 0; destPixel < destSize; destPixel++) {\n    // Scaling should be done relative to central pixel point\n    srcPixel = (destPixel + 0.5) * scaleInverted + offset;\n    srcFirst = Math.max(0, Math.floor(srcPixel - srcWindow));\n    srcLast = Math.min(srcSize - 1, Math.ceil(srcPixel + srcWindow));\n    filterElementSize = srcLast - srcFirst + 1;\n    floatFilter = new Float32Array(filterElementSize);\n    fxpFilter = new Int16Array(filterElementSize);\n    total = 0.0; // Fill filter values for calculated range\n\n    for (pxl = srcFirst, idx = 0; pxl <= srcLast; pxl++, idx++) {\n      floatVal = filterFunction((pxl + 0.5 - srcPixel) * scaleClamped);\n      total += floatVal;\n      floatFilter[idx] = floatVal;\n    } // Normalize filter, convert to fixed point and accumulate conversion error\n\n\n    filterTotal = 0;\n\n    for (idx = 0; idx < floatFilter.length; idx++) {\n      filterVal = floatFilter[idx] / total;\n      filterTotal += filterVal;\n      fxpFilter[idx] = toFixedPoint(filterVal);\n    } // Compensate normalization error, to minimize brightness drift\n\n\n    fxpFilter[destSize >> 1] += toFixedPoint(1.0 - filterTotal); //\n    // Now pack filter to useable form\n    //\n    // 1. Trim heading and tailing zero values, and compensate shitf/length\n    // 2. Put all to single array in this format:\n    //\n    //    [ pos shift, data length, value1, value2, value3, ... ]\n    //\n\n    leftNotEmpty = 0;\n\n    while (leftNotEmpty < fxpFilter.length && fxpFilter[leftNotEmpty] === 0) {\n      leftNotEmpty++;\n    }\n\n    if (leftNotEmpty < fxpFilter.length) {\n      rightNotEmpty = fxpFilter.length - 1;\n\n      while (rightNotEmpty > 0 && fxpFilter[rightNotEmpty] === 0) {\n        rightNotEmpty--;\n      }\n\n      filterShift = srcFirst + leftNotEmpty;\n      filterSize = rightNotEmpty - leftNotEmpty + 1;\n      packedFilter[packedFilterPtr++] = filterShift; // shift\n\n      packedFilter[packedFilterPtr++] = filterSize; // size\n\n      if (!slowCopy) {\n        packedFilter.set(fxpFilter.subarray(leftNotEmpty, rightNotEmpty + 1), packedFilterPtr);\n        packedFilterPtr += filterSize;\n      } else {\n        // fallback for old IE < 11, without subarray/set methods\n        for (idx = leftNotEmpty; idx <= rightNotEmpty; idx++) {\n          packedFilter[packedFilterPtr++] = fxpFilter[idx];\n        }\n      }\n    } else {\n      // zero data, write header only\n      packedFilter[packedFilterPtr++] = 0; // shift\n\n      packedFilter[packedFilterPtr++] = 0; // size\n    }\n  }\n\n  return packedFilter;\n};\n\n},{\"./resize_filter_info\":7}],7:[function(_dereq_,module,exports){\n// Filter definitions to build tables for\n// resizing convolvers.\n//\n// Presets for quality 0..3. Filter functions + window size\n//\n'use strict';\n\nmodule.exports = [{\n  // Nearest neibor (Box)\n  win: 0.5,\n  filter: function filter(x) {\n    return x >= -0.5 && x < 0.5 ? 1.0 : 0.0;\n  }\n}, {\n  // Hamming\n  win: 1.0,\n  filter: function filter(x) {\n    if (x <= -1.0 || x >= 1.0) {\n      return 0.0;\n    }\n\n    if (x > -1.19209290E-07 && x < 1.19209290E-07) {\n      return 1.0;\n    }\n\n    var xpi = x * Math.PI;\n    return Math.sin(xpi) / xpi * (0.54 + 0.46 * Math.cos(xpi / 1.0));\n  }\n}, {\n  // Lanczos, win = 2\n  win: 2.0,\n  filter: function filter(x) {\n    if (x <= -2.0 || x >= 2.0) {\n      return 0.0;\n    }\n\n    if (x > -1.19209290E-07 && x < 1.19209290E-07) {\n      return 1.0;\n    }\n\n    var xpi = x * Math.PI;\n    return Math.sin(xpi) / xpi * Math.sin(xpi / 2.0) / (xpi / 2.0);\n  }\n}, {\n  // Lanczos, win = 3\n  win: 3.0,\n  filter: function filter(x) {\n    if (x <= -3.0 || x >= 3.0) {\n      return 0.0;\n    }\n\n    if (x > -1.19209290E-07 && x < 1.19209290E-07) {\n      return 1.0;\n    }\n\n    var xpi = x * Math.PI;\n    return Math.sin(xpi) / xpi * Math.sin(xpi / 3.0) / (xpi / 3.0);\n  }\n}];\n\n},{}],8:[function(_dereq_,module,exports){\n'use strict';\n\nvar createFilters = _dereq_('./resize_filter_gen');\n\nfunction resetAlpha(dst, width, height) {\n  var ptr = 3,\n      len = width * height * 4 | 0;\n\n  while (ptr < len) {\n    dst[ptr] = 0xFF;\n    ptr = ptr + 4 | 0;\n  }\n}\n\nfunction asUint8Array(src) {\n  return new Uint8Array(src.buffer, 0, src.byteLength);\n}\n\nvar IS_LE = true; // should not crash everything on module load in old browsers\n\ntry {\n  IS_LE = new Uint32Array(new Uint8Array([1, 0, 0, 0]).buffer)[0] === 1;\n} catch (__) {}\n\nfunction copyInt16asLE(src, target, target_offset) {\n  if (IS_LE) {\n    target.set(asUint8Array(src), target_offset);\n    return;\n  }\n\n  for (var ptr = target_offset, i = 0; i < src.length; i++) {\n    var data = src[i];\n    target[ptr++] = data & 0xFF;\n    target[ptr++] = data >> 8 & 0xFF;\n  }\n}\n\nmodule.exports = function resize_wasm(options) {\n  var src = options.src;\n  var srcW = options.width;\n  var srcH = options.height;\n  var destW = options.toWidth;\n  var destH = options.toHeight;\n  var scaleX = options.scaleX || options.toWidth / options.width;\n  var scaleY = options.scaleY || options.toHeight / options.height;\n  var offsetX = options.offsetX || 0.0;\n  var offsetY = options.offsetY || 0.0;\n  var dest = options.dest || new Uint8Array(destW * destH * 4);\n  var quality = typeof options.quality === 'undefined' ? 3 : options.quality;\n  var alpha = options.alpha || false;\n  var filtersX = createFilters(quality, srcW, destW, scaleX, offsetX),\n      filtersY = createFilters(quality, srcH, destH, scaleY, offsetY); // destination is 0 too.\n\n  var src_offset = 0; // buffer between convolve passes\n\n  var tmp_offset = this.__align(src_offset + Math.max(src.byteLength, dest.byteLength));\n\n  var filtersX_offset = this.__align(tmp_offset + srcH * destW * 4);\n\n  var filtersY_offset = this.__align(filtersX_offset + filtersX.byteLength);\n\n  var alloc_bytes = filtersY_offset + filtersY.byteLength;\n\n  var instance = this.__instance('resize', alloc_bytes); //\n  // Fill memory block with data to process\n  //\n\n\n  var mem = new Uint8Array(this.__memory.buffer);\n  var mem32 = new Uint32Array(this.__memory.buffer); // 32-bit copy is much faster in chrome\n\n  var src32 = new Uint32Array(src.buffer);\n  mem32.set(src32); // We should guarantee LE bytes order. Filters are not big, so\n  // speed difference is not significant vs direct .set()\n\n  copyInt16asLE(filtersX, mem, filtersX_offset);\n  copyInt16asLE(filtersY, mem, filtersY_offset); //\n  // Now call webassembly method\n  // emsdk does method names with '_'\n\n  var fn = instance.exports.convolveHV || instance.exports._convolveHV;\n  fn(filtersX_offset, filtersY_offset, tmp_offset, srcW, srcH, destW, destH); //\n  // Copy data back to typed array\n  //\n  // 32-bit copy is much faster in chrome\n\n  var dest32 = new Uint32Array(dest.buffer);\n  dest32.set(new Uint32Array(this.__memory.buffer, 0, destH * destW)); // That's faster than doing checks in convolver.\n  // !!! Note, canvas data is not premultipled. We don't need other\n  // alpha corrections.\n\n  if (!alpha) resetAlpha(dest, destW, destH);\n  return dest;\n};\n\n},{\"./resize_filter_gen\":6}],9:[function(_dereq_,module,exports){\n'use strict';\n\nmodule.exports = {\n  name: 'unsharp_mask',\n  fn: _dereq_('./unsharp_mask'),\n  wasm_fn: _dereq_('./unsharp_mask_wasm'),\n  wasm_src: _dereq_('./unsharp_mask_wasm_base64')\n};\n\n},{\"./unsharp_mask\":10,\"./unsharp_mask_wasm\":11,\"./unsharp_mask_wasm_base64\":12}],10:[function(_dereq_,module,exports){\n// Unsharp mask filter\n//\n// http://stackoverflow.com/a/23322820/1031804\n// USM(O) = O + (2 * (Amount / 100) * (O - GB))\n// GB - gaussian blur.\n//\n// Image is converted from RGB to HSV, unsharp mask is applied to the\n// brightness channel and then image is converted back to RGB.\n//\n'use strict';\n\nvar glur_mono16 = _dereq_('glur/mono16');\n\nfunction hsv_v16(img, width, height) {\n  var size = width * height;\n  var out = new Uint16Array(size);\n  var r, g, b, max;\n\n  for (var i = 0; i < size; i++) {\n    r = img[4 * i];\n    g = img[4 * i + 1];\n    b = img[4 * i + 2];\n    max = r >= g && r >= b ? r : g >= b && g >= r ? g : b;\n    out[i] = max << 8;\n  }\n\n  return out;\n}\n\nmodule.exports = function unsharp(img, width, height, amount, radius, threshold) {\n  var v1, v2, vmul;\n  var diff, iTimes4;\n\n  if (amount === 0 || radius < 0.5) {\n    return;\n  }\n\n  if (radius > 2.0) {\n    radius = 2.0;\n  }\n\n  var brightness = hsv_v16(img, width, height);\n  var blured = new Uint16Array(brightness); // copy, because blur modify src\n\n  glur_mono16(blured, width, height, radius);\n  var amountFp = amount / 100 * 0x1000 + 0.5 | 0;\n  var thresholdFp = threshold << 8;\n  var size = width * height;\n  /* eslint-disable indent */\n\n  for (var i = 0; i < size; i++) {\n    v1 = brightness[i];\n    diff = v1 - blured[i];\n\n    if (Math.abs(diff) >= thresholdFp) {\n      // add unsharp mask to the brightness channel\n      v2 = v1 + (amountFp * diff + 0x800 >> 12); // Both v1 and v2 are within [0.0 .. 255.0] (0000-FF00) range, never going into\n      // [255.003 .. 255.996] (FF01-FFFF). This allows to round this value as (x+.5)|0\n      // later without overflowing.\n\n      v2 = v2 > 0xff00 ? 0xff00 : v2;\n      v2 = v2 < 0x0000 ? 0x0000 : v2; // Avoid division by 0. V=0 means rgb(0,0,0), unsharp with unsharpAmount>0 cannot\n      // change this value (because diff between colors gets inflated), so no need to verify correctness.\n\n      v1 = v1 !== 0 ? v1 : 1; // Multiplying V in HSV model by a constant is equivalent to multiplying each component\n      // in RGB by the same constant (same for HSL), see also:\n      // https://beesbuzz.biz/code/16-hsv-color-transforms\n\n      vmul = (v2 << 12) / v1 | 0; // Result will be in [0..255] range because:\n      //  - all numbers are positive\n      //  - r,g,b <= (v1/256)\n      //  - r,g,b,(v1/256),(v2/256) <= 255\n      // So highest this number can get is X*255/X+0.5=255.5 which is < 256 and rounds down.\n\n      iTimes4 = i * 4;\n      img[iTimes4] = img[iTimes4] * vmul + 0x800 >> 12; // R\n\n      img[iTimes4 + 1] = img[iTimes4 + 1] * vmul + 0x800 >> 12; // G\n\n      img[iTimes4 + 2] = img[iTimes4 + 2] * vmul + 0x800 >> 12; // B\n    }\n  }\n};\n\n},{\"glur/mono16\":18}],11:[function(_dereq_,module,exports){\n'use strict';\n\nmodule.exports = function unsharp(img, width, height, amount, radius, threshold) {\n  if (amount === 0 || radius < 0.5) {\n    return;\n  }\n\n  if (radius > 2.0) {\n    radius = 2.0;\n  }\n\n  var pixels = width * height;\n  var img_bytes_cnt = pixels * 4;\n  var hsv_bytes_cnt = pixels * 2;\n  var blur_bytes_cnt = pixels * 2;\n  var blur_line_byte_cnt = Math.max(width, height) * 4; // float32 array\n\n  var blur_coeffs_byte_cnt = 8 * 4; // float32 array\n\n  var img_offset = 0;\n  var hsv_offset = img_bytes_cnt;\n  var blur_offset = hsv_offset + hsv_bytes_cnt;\n  var blur_tmp_offset = blur_offset + blur_bytes_cnt;\n  var blur_line_offset = blur_tmp_offset + blur_bytes_cnt;\n  var blur_coeffs_offset = blur_line_offset + blur_line_byte_cnt;\n\n  var instance = this.__instance('unsharp_mask', img_bytes_cnt + hsv_bytes_cnt + blur_bytes_cnt * 2 + blur_line_byte_cnt + blur_coeffs_byte_cnt, {\n    exp: Math.exp\n  }); // 32-bit copy is much faster in chrome\n\n\n  var img32 = new Uint32Array(img.buffer);\n  var mem32 = new Uint32Array(this.__memory.buffer);\n  mem32.set(img32); // HSL\n\n  var fn = instance.exports.hsv_v16 || instance.exports._hsv_v16;\n  fn(img_offset, hsv_offset, width, height); // BLUR\n\n  fn = instance.exports.blurMono16 || instance.exports._blurMono16;\n  fn(hsv_offset, blur_offset, blur_tmp_offset, blur_line_offset, blur_coeffs_offset, width, height, radius); // UNSHARP\n\n  fn = instance.exports.unsharp || instance.exports._unsharp;\n  fn(img_offset, img_offset, hsv_offset, blur_offset, width, height, amount, threshold); // 32-bit copy is much faster in chrome\n\n  img32.set(new Uint32Array(this.__memory.buffer, 0, pixels));\n};\n\n},{}],12:[function(_dereq_,module,exports){\n// This is autogenerated file from math.wasm, don't edit.\n//\n'use strict';\n/* eslint-disable max-len */\n\nmodule.exports = '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';\n\n},{}],13:[function(_dereq_,module,exports){\n'use strict';\n\nvar GC_INTERVAL = 100;\n\nfunction Pool(create, idle) {\n  this.create = create;\n  this.available = [];\n  this.acquired = {};\n  this.lastId = 1;\n  this.timeoutId = 0;\n  this.idle = idle || 2000;\n}\n\nPool.prototype.acquire = function () {\n  var _this = this;\n\n  var resource;\n\n  if (this.available.length !== 0) {\n    resource = this.available.pop();\n  } else {\n    resource = this.create();\n    resource.id = this.lastId++;\n\n    resource.release = function () {\n      return _this.release(resource);\n    };\n  }\n\n  this.acquired[resource.id] = resource;\n  return resource;\n};\n\nPool.prototype.release = function (resource) {\n  var _this2 = this;\n\n  delete this.acquired[resource.id];\n  resource.lastUsed = Date.now();\n  this.available.push(resource);\n\n  if (this.timeoutId === 0) {\n    this.timeoutId = setTimeout(function () {\n      return _this2.gc();\n    }, GC_INTERVAL);\n  }\n};\n\nPool.prototype.gc = function () {\n  var _this3 = this;\n\n  var now = Date.now();\n  this.available = this.available.filter(function (resource) {\n    if (now - resource.lastUsed > _this3.idle) {\n      resource.destroy();\n      return false;\n    }\n\n    return true;\n  });\n\n  if (this.available.length !== 0) {\n    this.timeoutId = setTimeout(function () {\n      return _this3.gc();\n    }, GC_INTERVAL);\n  } else {\n    this.timeoutId = 0;\n  }\n};\n\nmodule.exports = Pool;\n\n},{}],14:[function(_dereq_,module,exports){\n// Add intermediate resizing steps when scaling down by a very large factor.\n//\n// For example, when resizing 10000x10000 down to 10x10, it'll resize it to\n// 300x300 first.\n//\n// It's needed because tiler has issues when the entire tile is scaled down\n// to a few pixels (1024px source tile with border size 3 should result in\n// at least 3+3+2 = 8px target tile, so max scale factor is 128 here).\n//\n// Also, adding intermediate steps can speed up processing if we use lower\n// quality algorithms for first stages.\n//\n'use strict'; // min size = 0 results in infinite loop,\n// min size = 1 can consume large amount of memory\n\nvar MIN_INNER_TILE_SIZE = 2;\n\nmodule.exports = function createStages(fromWidth, fromHeight, toWidth, toHeight, srcTileSize, destTileBorder) {\n  var scaleX = toWidth / fromWidth;\n  var scaleY = toHeight / fromHeight; // derived from createRegions equation:\n  // innerTileWidth = pixelFloor(srcTileSize * scaleX) - 2 * destTileBorder;\n\n  var minScale = (2 * destTileBorder + MIN_INNER_TILE_SIZE + 1) / srcTileSize; // refuse to scale image multiple times by less than twice each time,\n  // it could only happen because of invalid options\n\n  if (minScale > 0.5) return [[toWidth, toHeight]];\n  var stageCount = Math.ceil(Math.log(Math.min(scaleX, scaleY)) / Math.log(minScale)); // no additional resizes are necessary,\n  // stageCount can be zero or be negative when enlarging the image\n\n  if (stageCount <= 1) return [[toWidth, toHeight]];\n  var result = [];\n\n  for (var i = 0; i < stageCount; i++) {\n    var width = Math.round(Math.pow(Math.pow(fromWidth, stageCount - i - 1) * Math.pow(toWidth, i + 1), 1 / stageCount));\n    var height = Math.round(Math.pow(Math.pow(fromHeight, stageCount - i - 1) * Math.pow(toHeight, i + 1), 1 / stageCount));\n    result.push([width, height]);\n  }\n\n  return result;\n};\n\n},{}],15:[function(_dereq_,module,exports){\n// Split original image into multiple 1024x1024 chunks to reduce memory usage\n// (images have to be unpacked into typed arrays for resizing) and allow\n// parallel processing of multiple tiles at a time.\n//\n'use strict';\n/*\n * pixelFloor and pixelCeil are modified versions of Math.floor and Math.ceil\n * functions which take into account floating point arithmetic errors.\n * Those errors can cause undesired increments/decrements of sizes and offsets:\n * Math.ceil(36 / (36 / 500)) = 501\n * pixelCeil(36 / (36 / 500)) = 500\n */\n\nvar PIXEL_EPSILON = 1e-5;\n\nfunction pixelFloor(x) {\n  var nearest = Math.round(x);\n\n  if (Math.abs(x - nearest) < PIXEL_EPSILON) {\n    return nearest;\n  }\n\n  return Math.floor(x);\n}\n\nfunction pixelCeil(x) {\n  var nearest = Math.round(x);\n\n  if (Math.abs(x - nearest) < PIXEL_EPSILON) {\n    return nearest;\n  }\n\n  return Math.ceil(x);\n}\n\nmodule.exports = function createRegions(options) {\n  var scaleX = options.toWidth / options.width;\n  var scaleY = options.toHeight / options.height;\n  var innerTileWidth = pixelFloor(options.srcTileSize * scaleX) - 2 * options.destTileBorder;\n  var innerTileHeight = pixelFloor(options.srcTileSize * scaleY) - 2 * options.destTileBorder; // prevent infinite loop, this should never happen\n\n  if (innerTileWidth < 1 || innerTileHeight < 1) {\n    throw new Error('Internal error in pica: target tile width/height is too small.');\n  }\n\n  var x, y;\n  var innerX, innerY, toTileWidth, toTileHeight;\n  var tiles = [];\n  var tile; // we go top-to-down instead of left-to-right to make image displayed from top to\n  // doesn in the browser\n\n  for (innerY = 0; innerY < options.toHeight; innerY += innerTileHeight) {\n    for (innerX = 0; innerX < options.toWidth; innerX += innerTileWidth) {\n      x = innerX - options.destTileBorder;\n\n      if (x < 0) {\n        x = 0;\n      }\n\n      toTileWidth = innerX + innerTileWidth + options.destTileBorder - x;\n\n      if (x + toTileWidth >= options.toWidth) {\n        toTileWidth = options.toWidth - x;\n      }\n\n      y = innerY - options.destTileBorder;\n\n      if (y < 0) {\n        y = 0;\n      }\n\n      toTileHeight = innerY + innerTileHeight + options.destTileBorder - y;\n\n      if (y + toTileHeight >= options.toHeight) {\n        toTileHeight = options.toHeight - y;\n      }\n\n      tile = {\n        toX: x,\n        toY: y,\n        toWidth: toTileWidth,\n        toHeight: toTileHeight,\n        toInnerX: innerX,\n        toInnerY: innerY,\n        toInnerWidth: innerTileWidth,\n        toInnerHeight: innerTileHeight,\n        offsetX: x / scaleX - pixelFloor(x / scaleX),\n        offsetY: y / scaleY - pixelFloor(y / scaleY),\n        scaleX: scaleX,\n        scaleY: scaleY,\n        x: pixelFloor(x / scaleX),\n        y: pixelFloor(y / scaleY),\n        width: pixelCeil(toTileWidth / scaleX),\n        height: pixelCeil(toTileHeight / scaleY)\n      };\n      tiles.push(tile);\n    }\n  }\n\n  return tiles;\n};\n\n},{}],16:[function(_dereq_,module,exports){\n'use strict';\n\nfunction objClass(obj) {\n  return Object.prototype.toString.call(obj);\n}\n\nmodule.exports.isCanvas = function isCanvas(element) {\n  var cname = objClass(element);\n  return cname === '[object HTMLCanvasElement]'\n  /* browser */\n  || cname === '[object OffscreenCanvas]' || cname === '[object Canvas]'\n  /* node-canvas */\n  ;\n};\n\nmodule.exports.isImage = function isImage(element) {\n  return objClass(element) === '[object HTMLImageElement]';\n};\n\nmodule.exports.isImageBitmap = function isImageBitmap(element) {\n  return objClass(element) === '[object ImageBitmap]';\n};\n\nmodule.exports.limiter = function limiter(concurrency) {\n  var active = 0,\n      queue = [];\n\n  function roll() {\n    if (active < concurrency && queue.length) {\n      active++;\n      queue.shift()();\n    }\n  }\n\n  return function limit(fn) {\n    return new Promise(function (resolve, reject) {\n      queue.push(function () {\n        fn().then(function (result) {\n          resolve(result);\n          active--;\n          roll();\n        }, function (err) {\n          reject(err);\n          active--;\n          roll();\n        });\n      });\n      roll();\n    });\n  };\n};\n\nmodule.exports.cib_quality_name = function cib_quality_name(num) {\n  switch (num) {\n    case 0:\n      return 'pixelated';\n\n    case 1:\n      return 'low';\n\n    case 2:\n      return 'medium';\n  }\n\n  return 'high';\n};\n\nmodule.exports.cib_support = function cib_support(createCanvas) {\n  return Promise.resolve().then(function () {\n    if (typeof createImageBitmap === 'undefined') {\n      return false;\n    }\n\n    var c = createCanvas(100, 100);\n    return createImageBitmap(c, 0, 0, 100, 100, {\n      resizeWidth: 10,\n      resizeHeight: 10,\n      resizeQuality: 'high'\n    }).then(function (bitmap) {\n      var status = bitmap.width === 10; // Branch below is filtered on upper level. We do not call resize\n      // detection for basic ImageBitmap.\n      //\n      // https://developer.mozilla.org/en-US/docs/Web/API/ImageBitmap\n      // old Crome 51 has ImageBitmap without .close(). Then this code\n      // will throw and return 'false' as expected.\n      //\n\n      bitmap.close();\n      c = null;\n      return status;\n    });\n  })[\"catch\"](function () {\n    return false;\n  });\n};\n\nmodule.exports.worker_offscreen_canvas_support = function worker_offscreen_canvas_support() {\n  return new Promise(function (resolve, reject) {\n    if (typeof OffscreenCanvas === 'undefined') {\n      // if OffscreenCanvas is present, we assume browser supports Worker and built-in Promise as well\n      resolve(false);\n      return;\n    }\n\n    function workerPayload(self) {\n      if (typeof createImageBitmap === 'undefined') {\n        self.postMessage(false);\n        return;\n      }\n\n      Promise.resolve().then(function () {\n        var canvas = new OffscreenCanvas(10, 10); // test that 2d context can be used in worker\n\n        var ctx = canvas.getContext('2d');\n        ctx.rect(0, 0, 1, 1); // test that cib can be used to return image bitmap from worker\n\n        return createImageBitmap(canvas, 0, 0, 1, 1);\n      }).then(function () {\n        return self.postMessage(true);\n      }, function () {\n        return self.postMessage(false);\n      });\n    }\n\n    var code = btoa(\"(\".concat(workerPayload.toString(), \")(self);\"));\n    var w = new Worker(\"data:text/javascript;base64,\".concat(code));\n\n    w.onmessage = function (ev) {\n      return resolve(ev.data);\n    };\n\n    w.onerror = reject;\n  }).then(function (result) {\n    return result;\n  }, function () {\n    return false;\n  });\n}; // Check if canvas.getContext('2d').getImageData can be used,\n// FireFox randomizes the output of that function in `privacy.resistFingerprinting` mode\n\n\nmodule.exports.can_use_canvas = function can_use_canvas(createCanvas) {\n  var usable = false;\n\n  try {\n    var canvas = createCanvas(2, 1);\n    var ctx = canvas.getContext('2d');\n    var d = ctx.createImageData(2, 1);\n    d.data[0] = 12;\n    d.data[1] = 23;\n    d.data[2] = 34;\n    d.data[3] = 255;\n    d.data[4] = 45;\n    d.data[5] = 56;\n    d.data[6] = 67;\n    d.data[7] = 255;\n    ctx.putImageData(d, 0, 0);\n    d = null;\n    d = ctx.getImageData(0, 0, 2, 1);\n\n    if (d.data[0] === 12 && d.data[1] === 23 && d.data[2] === 34 && d.data[3] === 255 && d.data[4] === 45 && d.data[5] === 56 && d.data[6] === 67 && d.data[7] === 255) {\n      usable = true;\n    }\n  } catch (err) {}\n\n  return usable;\n}; // Check if createImageBitmap(img, sx, sy, sw, sh) signature works correctly\n// with JPEG images oriented with Exif;\n// https://bugs.chromium.org/p/chromium/issues/detail?id=1220671\n// TODO: remove after it's fixed in chrome for at least 2 releases\n\n\nmodule.exports.cib_can_use_region = function cib_can_use_region() {\n  return new Promise(function (resolve) {\n    if (typeof createImageBitmap === 'undefined') {\n      resolve(false);\n      return;\n    }\n\n    var image = new Image();\n    image.src = 'data:image/jpeg;base64,' + '/9j/4QBiRXhpZgAATU0AKgAAAAgABQESAAMAAAABAAYAAAEaAAUAAAABAAAASgEbAAUAA' + 'AABAAAAUgEoAAMAAAABAAIAAAITAAMAAAABAAEAAAAAAAAAAABIAAAAAQAAAEgAAAAB/9' + 'sAQwAEAwMEAwMEBAMEBQQEBQYKBwYGBgYNCQoICg8NEBAPDQ8OERMYFBESFxIODxUcFRc' + 'ZGRsbGxAUHR8dGh8YGhsa/9sAQwEEBQUGBQYMBwcMGhEPERoaGhoaGhoaGhoaGhoaGhoa' + 'GhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoa/8IAEQgAAQACAwERAAIRAQMRA' + 'f/EABQAAQAAAAAAAAAAAAAAAAAAAAf/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAA' + 'IQAxAAAAF/P//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAQUCf//EABQRAQAAAAA' + 'AAAAAAAAAAAAAAAD/2gAIAQMBAT8Bf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIB' + 'AT8Bf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEABj8Cf//EABQQAQAAAAAAAAAAA' + 'AAAAAAAAAD/2gAIAQEAAT8hf//aAAwDAQACAAMAAAAQH//EABQRAQAAAAAAAAAAAAAAAA' + 'AAAAD/2gAIAQMBAT8Qf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Qf//EABQ' + 'QAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8Qf//Z';\n\n    image.onload = function () {\n      createImageBitmap(image, 0, 0, image.width, image.height).then(function (bitmap) {\n        if (bitmap.width === image.width && bitmap.height === image.height) {\n          resolve(true);\n        } else {\n          resolve(false);\n        }\n      }, function () {\n        return resolve(false);\n      });\n    };\n\n    image.onerror = function () {\n      return resolve(false);\n    };\n  });\n};\n\n},{}],17:[function(_dereq_,module,exports){\n// Web Worker wrapper for image resize function\n'use strict';\n\nmodule.exports = function () {\n  var MathLib = _dereq_('./mathlib');\n\n  var mathLib;\n  /* eslint-disable no-undef */\n\n  onmessage = function onmessage(ev) {\n    var tileOpts = ev.data.opts;\n    var returnBitmap = false;\n\n    if (!tileOpts.src && tileOpts.srcBitmap) {\n      var canvas = new OffscreenCanvas(tileOpts.width, tileOpts.height);\n      var ctx = canvas.getContext('2d', {\n        alpha: Boolean(tileOpts.alpha)\n      });\n      ctx.drawImage(tileOpts.srcBitmap, 0, 0);\n      tileOpts.src = ctx.getImageData(0, 0, tileOpts.width, tileOpts.height).data;\n      canvas.width = canvas.height = 0;\n      canvas = null;\n      tileOpts.srcBitmap.close();\n      tileOpts.srcBitmap = null;\n      returnBitmap = true;\n    }\n\n    if (!mathLib) mathLib = new MathLib(ev.data.features); // Use multimath's sync auto-init. Avoid Promise use in old browsers,\n    // because polyfills are not propagated to webworker.\n\n    var data = mathLib.resizeAndUnsharp(tileOpts);\n\n    if (returnBitmap) {\n      var toImageData = new ImageData(new Uint8ClampedArray(data), tileOpts.toWidth, tileOpts.toHeight);\n\n      var _canvas = new OffscreenCanvas(tileOpts.toWidth, tileOpts.toHeight);\n\n      var _ctx = _canvas.getContext('2d', {\n        alpha: Boolean(tileOpts.alpha)\n      });\n\n      _ctx.putImageData(toImageData, 0, 0);\n\n      createImageBitmap(_canvas).then(function (bitmap) {\n        postMessage({\n          bitmap: bitmap\n        }, [bitmap]);\n      });\n    } else {\n      postMessage({\n        data: data\n      }, [data.buffer]);\n    }\n  };\n};\n\n},{\"./mathlib\":1}],18:[function(_dereq_,module,exports){\n// Calculate Gaussian blur of an image using IIR filter\n// The method is taken from Intel's white paper and code example attached to it:\n// https://software.intel.com/en-us/articles/iir-gaussian-blur-filter\n// -implementation-using-intel-advanced-vector-extensions\n\nvar a0, a1, a2, a3, b1, b2, left_corner, right_corner;\n\nfunction gaussCoef(sigma) {\n  if (sigma < 0.5) {\n    sigma = 0.5;\n  }\n\n  var a = Math.exp(0.726 * 0.726) / sigma,\n      g1 = Math.exp(-a),\n      g2 = Math.exp(-2 * a),\n      k = (1 - g1) * (1 - g1) / (1 + 2 * a * g1 - g2);\n\n  a0 = k;\n  a1 = k * (a - 1) * g1;\n  a2 = k * (a + 1) * g1;\n  a3 = -k * g2;\n  b1 = 2 * g1;\n  b2 = -g2;\n  left_corner = (a0 + a1) / (1 - b1 - b2);\n  right_corner = (a2 + a3) / (1 - b1 - b2);\n\n  // Attempt to force type to FP32.\n  return new Float32Array([ a0, a1, a2, a3, b1, b2, left_corner, right_corner ]);\n}\n\nfunction convolveMono16(src, out, line, coeff, width, height) {\n  // takes src image and writes the blurred and transposed result into out\n\n  var prev_src, curr_src, curr_out, prev_out, prev_prev_out;\n  var src_index, out_index, line_index;\n  var i, j;\n  var coeff_a0, coeff_a1, coeff_b1, coeff_b2;\n\n  for (i = 0; i < height; i++) {\n    src_index = i * width;\n    out_index = i;\n    line_index = 0;\n\n    // left to right\n    prev_src = src[src_index];\n    prev_prev_out = prev_src * coeff[6];\n    prev_out = prev_prev_out;\n\n    coeff_a0 = coeff[0];\n    coeff_a1 = coeff[1];\n    coeff_b1 = coeff[4];\n    coeff_b2 = coeff[5];\n\n    for (j = 0; j < width; j++) {\n      curr_src = src[src_index];\n\n      curr_out = curr_src * coeff_a0 +\n                 prev_src * coeff_a1 +\n                 prev_out * coeff_b1 +\n                 prev_prev_out * coeff_b2;\n\n      prev_prev_out = prev_out;\n      prev_out = curr_out;\n      prev_src = curr_src;\n\n      line[line_index] = prev_out;\n      line_index++;\n      src_index++;\n    }\n\n    src_index--;\n    line_index--;\n    out_index += height * (width - 1);\n\n    // right to left\n    prev_src = src[src_index];\n    prev_prev_out = prev_src * coeff[7];\n    prev_out = prev_prev_out;\n    curr_src = prev_src;\n\n    coeff_a0 = coeff[2];\n    coeff_a1 = coeff[3];\n\n    for (j = width - 1; j >= 0; j--) {\n      curr_out = curr_src * coeff_a0 +\n                 prev_src * coeff_a1 +\n                 prev_out * coeff_b1 +\n                 prev_prev_out * coeff_b2;\n\n      prev_prev_out = prev_out;\n      prev_out = curr_out;\n\n      prev_src = curr_src;\n      curr_src = src[src_index];\n\n      out[out_index] = line[line_index] + prev_out;\n\n      src_index--;\n      line_index--;\n      out_index -= height;\n    }\n  }\n}\n\n\nfunction blurMono16(src, width, height, radius) {\n  // Quick exit on zero radius\n  if (!radius) { return; }\n\n  var out      = new Uint16Array(src.length),\n      tmp_line = new Float32Array(Math.max(width, height));\n\n  var coeff = gaussCoef(radius);\n\n  convolveMono16(src, out, tmp_line, coeff, width, height, radius);\n  convolveMono16(out, src, tmp_line, coeff, height, width, radius);\n}\n\nmodule.exports = blurMono16;\n\n},{}],19:[function(_dereq_,module,exports){\nif (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    if (superCtor) {\n      ctor.super_ = superCtor\n      ctor.prototype = Object.create(superCtor.prototype, {\n        constructor: {\n          value: ctor,\n          enumerable: false,\n          writable: true,\n          configurable: true\n        }\n      })\n    }\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    if (superCtor) {\n      ctor.super_ = superCtor\n      var TempCtor = function () {}\n      TempCtor.prototype = superCtor.prototype\n      ctor.prototype = new TempCtor()\n      ctor.prototype.constructor = ctor\n    }\n  }\n}\n\n},{}],20:[function(_dereq_,module,exports){\n'use strict';\n\n\nvar assign         = _dereq_('object-assign');\nvar base64decode   = _dereq_('./lib/base64decode');\nvar hasWebAssembly = _dereq_('./lib/wa_detect');\n\n\nvar DEFAULT_OPTIONS = {\n  js: true,\n  wasm: true\n};\n\n\nfunction MultiMath(options) {\n  if (!(this instanceof MultiMath)) return new MultiMath(options);\n\n  var opts = assign({}, DEFAULT_OPTIONS, options || {});\n\n  this.options         = opts;\n\n  this.__cache         = {};\n\n  this.__init_promise  = null;\n  this.__modules       = opts.modules || {};\n  this.__memory        = null;\n  this.__wasm          = {};\n\n  this.__isLE = ((new Uint32Array((new Uint8Array([ 1, 0, 0, 0 ])).buffer))[0] === 1);\n\n  if (!this.options.js && !this.options.wasm) {\n    throw new Error('mathlib: at least \"js\" or \"wasm\" should be enabled');\n  }\n}\n\n\nMultiMath.prototype.has_wasm = hasWebAssembly;\n\n\nMultiMath.prototype.use = function (module) {\n  this.__modules[module.name] = module;\n\n  // Pin the best possible implementation\n  if (this.options.wasm && this.has_wasm() && module.wasm_fn) {\n    this[module.name] = module.wasm_fn;\n  } else {\n    this[module.name] = module.fn;\n  }\n\n  return this;\n};\n\n\nMultiMath.prototype.init = function () {\n  if (this.__init_promise) return this.__init_promise;\n\n  if (!this.options.js && this.options.wasm && !this.has_wasm()) {\n    return Promise.reject(new Error('mathlib: only \"wasm\" was enabled, but it\\'s not supported'));\n  }\n\n  var self = this;\n\n  this.__init_promise = Promise.all(Object.keys(self.__modules).map(function (name) {\n    var module = self.__modules[name];\n\n    if (!self.options.wasm || !self.has_wasm() || !module.wasm_fn) return null;\n\n    // If already compiled - exit\n    if (self.__wasm[name]) return null;\n\n    // Compile wasm source\n    return WebAssembly.compile(self.__base64decode(module.wasm_src))\n      .then(function (m) { self.__wasm[name] = m; });\n  }))\n    .then(function () { return self; });\n\n  return this.__init_promise;\n};\n\n\n////////////////////////////////////////////////////////////////////////////////\n// Methods below are for internal use from plugins\n\n\n// Simple decode base64 to typed array. Useful to load embedded webassembly\n// code. You probably don't need to call this method directly.\n//\nMultiMath.prototype.__base64decode = base64decode;\n\n\n// Increase current memory to include specified number of bytes. Do nothing if\n// size is already ok. You probably don't need to call this method directly,\n// because it will be invoked from `.__instance()`.\n//\nMultiMath.prototype.__reallocate = function mem_grow_to(bytes) {\n  if (!this.__memory) {\n    this.__memory = new WebAssembly.Memory({\n      initial: Math.ceil(bytes / (64 * 1024))\n    });\n    return this.__memory;\n  }\n\n  var mem_size = this.__memory.buffer.byteLength;\n\n  if (mem_size < bytes) {\n    this.__memory.grow(Math.ceil((bytes - mem_size) / (64 * 1024)));\n  }\n\n  return this.__memory;\n};\n\n\n// Returns instantinated webassembly item by name, with specified memory size\n// and environment.\n// - use cache if available\n// - do sync module init, if async init was not called earlier\n// - allocate memory if not enougth\n// - can export functions to webassembly via \"env_extra\",\n//   for example, { exp: Math.exp }\n//\nMultiMath.prototype.__instance = function instance(name, memsize, env_extra) {\n  if (memsize) this.__reallocate(memsize);\n\n  // If .init() was not called, do sync compile\n  if (!this.__wasm[name]) {\n    var module = this.__modules[name];\n    this.__wasm[name] = new WebAssembly.Module(this.__base64decode(module.wasm_src));\n  }\n\n  if (!this.__cache[name]) {\n    var env_base = {\n      memoryBase: 0,\n      memory: this.__memory,\n      tableBase: 0,\n      table: new WebAssembly.Table({ initial: 0, element: 'anyfunc' })\n    };\n\n    this.__cache[name] = new WebAssembly.Instance(this.__wasm[name], {\n      env: assign(env_base, env_extra || {})\n    });\n  }\n\n  return this.__cache[name];\n};\n\n\n// Helper to calculate memory aligh for pointers. Webassembly does not require\n// this, but you may wish to experiment. Default base = 8;\n//\nMultiMath.prototype.__align = function align(number, base) {\n  base = base || 8;\n  var reminder = number % base;\n  return number + (reminder ? base - reminder : 0);\n};\n\n\nmodule.exports = MultiMath;\n\n},{\"./lib/base64decode\":21,\"./lib/wa_detect\":22,\"object-assign\":23}],21:[function(_dereq_,module,exports){\n// base64 decode str -> Uint8Array, to load WA modules\n//\n'use strict';\n\n\nvar BASE64_MAP = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n\n\nmodule.exports = function base64decode(str) {\n  var input = str.replace(/[\\r\\n=]/g, ''), // remove CR/LF & padding to simplify scan\n      max   = input.length;\n\n  var out = new Uint8Array((max * 3) >> 2);\n\n  // Collect by 6*4 bits (3 bytes)\n\n  var bits = 0;\n  var ptr  = 0;\n\n  for (var idx = 0; idx < max; idx++) {\n    if ((idx % 4 === 0) && idx) {\n      out[ptr++] = (bits >> 16) & 0xFF;\n      out[ptr++] = (bits >> 8) & 0xFF;\n      out[ptr++] = bits & 0xFF;\n    }\n\n    bits = (bits << 6) | BASE64_MAP.indexOf(input.charAt(idx));\n  }\n\n  // Dump tail\n\n  var tailbits = (max % 4) * 6;\n\n  if (tailbits === 0) {\n    out[ptr++] = (bits >> 16) & 0xFF;\n    out[ptr++] = (bits >> 8) & 0xFF;\n    out[ptr++] = bits & 0xFF;\n  } else if (tailbits === 18) {\n    out[ptr++] = (bits >> 10) & 0xFF;\n    out[ptr++] = (bits >> 2) & 0xFF;\n  } else if (tailbits === 12) {\n    out[ptr++] = (bits >> 4) & 0xFF;\n  }\n\n  return out;\n};\n\n},{}],22:[function(_dereq_,module,exports){\n// Detect WebAssembly support.\n// - Check global WebAssembly object\n// - Try to load simple module (can be disabled via CSP)\n//\n'use strict';\n\n\nvar wa;\n\n\nmodule.exports = function hasWebAssembly() {\n  // use cache if called before;\n  if (typeof wa !== 'undefined') return wa;\n\n  wa = false;\n\n  if (typeof WebAssembly === 'undefined') return wa;\n\n  // If WebAssenbly is disabled, code can throw on compile\n  try {\n    // https://github.com/brion/min-wasm-fail/blob/master/min-wasm-fail.in.js\n    // Additional check that WA internals are correct\n\n    /* eslint-disable comma-spacing, max-len */\n    var bin      = new Uint8Array([ 0,97,115,109,1,0,0,0,1,6,1,96,1,127,1,127,3,2,1,0,5,3,1,0,1,7,8,1,4,116,101,115,116,0,0,10,16,1,14,0,32,0,65,1,54,2,0,32,0,40,2,0,11 ]);\n    var module   = new WebAssembly.Module(bin);\n    var instance = new WebAssembly.Instance(module, {});\n\n    // test storing to and loading from a non-zero location via a parameter.\n    // Safari on iOS 11.2.5 returns 0 unexpectedly at non-zero locations\n    if (instance.exports.test(4) !== 0) wa = true;\n\n    return wa;\n  } catch (__) {}\n\n  return wa;\n};\n\n},{}],23:[function(_dereq_,module,exports){\n/*\nobject-assign\n(c) Sindre Sorhus\n@license MIT\n*/\n\n'use strict';\n/* eslint-disable no-unused-vars */\nvar getOwnPropertySymbols = Object.getOwnPropertySymbols;\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\nvar propIsEnumerable = Object.prototype.propertyIsEnumerable;\n\nfunction toObject(val) {\n\tif (val === null || val === undefined) {\n\t\tthrow new TypeError('Object.assign cannot be called with null or undefined');\n\t}\n\n\treturn Object(val);\n}\n\nfunction shouldUseNative() {\n\ttry {\n\t\tif (!Object.assign) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Detect buggy property enumeration order in older V8 versions.\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=4118\n\t\tvar test1 = new String('abc');  // eslint-disable-line no-new-wrappers\n\t\ttest1[5] = 'de';\n\t\tif (Object.getOwnPropertyNames(test1)[0] === '5') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test2 = {};\n\t\tfor (var i = 0; i < 10; i++) {\n\t\t\ttest2['_' + String.fromCharCode(i)] = i;\n\t\t}\n\t\tvar order2 = Object.getOwnPropertyNames(test2).map(function (n) {\n\t\t\treturn test2[n];\n\t\t});\n\t\tif (order2.join('') !== '0123456789') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test3 = {};\n\t\t'abcdefghijklmnopqrst'.split('').forEach(function (letter) {\n\t\t\ttest3[letter] = letter;\n\t\t});\n\t\tif (Object.keys(Object.assign({}, test3)).join('') !==\n\t\t\t\t'abcdefghijklmnopqrst') {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t} catch (err) {\n\t\t// We don't expect any of the above to throw, but better to be safe.\n\t\treturn false;\n\t}\n}\n\nmodule.exports = shouldUseNative() ? Object.assign : function (target, source) {\n\tvar from;\n\tvar to = toObject(target);\n\tvar symbols;\n\n\tfor (var s = 1; s < arguments.length; s++) {\n\t\tfrom = Object(arguments[s]);\n\n\t\tfor (var key in from) {\n\t\t\tif (hasOwnProperty.call(from, key)) {\n\t\t\t\tto[key] = from[key];\n\t\t\t}\n\t\t}\n\n\t\tif (getOwnPropertySymbols) {\n\t\t\tsymbols = getOwnPropertySymbols(from);\n\t\t\tfor (var i = 0; i < symbols.length; i++) {\n\t\t\t\tif (propIsEnumerable.call(from, symbols[i])) {\n\t\t\t\t\tto[symbols[i]] = from[symbols[i]];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn to;\n};\n\n},{}],24:[function(_dereq_,module,exports){\nvar bundleFn = arguments[3];\nvar sources = arguments[4];\nvar cache = arguments[5];\n\nvar stringify = JSON.stringify;\n\nmodule.exports = function (fn, options) {\n    var wkey;\n    var cacheKeys = Object.keys(cache);\n\n    for (var i = 0, l = cacheKeys.length; i < l; i++) {\n        var key = cacheKeys[i];\n        var exp = cache[key].exports;\n        // Using babel as a transpiler to use esmodule, the export will always\n        // be an object with the default export as a property of it. To ensure\n        // the existing api and babel esmodule exports are both supported we\n        // check for both\n        if (exp === fn || exp && exp.default === fn) {\n            wkey = key;\n            break;\n        }\n    }\n\n    if (!wkey) {\n        wkey = Math.floor(Math.pow(16, 8) * Math.random()).toString(16);\n        var wcache = {};\n        for (var i = 0, l = cacheKeys.length; i < l; i++) {\n            var key = cacheKeys[i];\n            wcache[key] = key;\n        }\n        sources[wkey] = [\n            'function(require,module,exports){' + fn + '(self); }',\n            wcache\n        ];\n    }\n    var skey = Math.floor(Math.pow(16, 8) * Math.random()).toString(16);\n\n    var scache = {}; scache[wkey] = wkey;\n    sources[skey] = [\n        'function(require,module,exports){' +\n            // try to call default if defined to also support babel esmodule exports\n            'var f = require(' + stringify(wkey) + ');' +\n            '(f.default ? f.default : f)(self);' +\n        '}',\n        scache\n    ];\n\n    var workerSources = {};\n    resolveSources(skey);\n\n    function resolveSources(key) {\n        workerSources[key] = true;\n\n        for (var depPath in sources[key][1]) {\n            var depKey = sources[key][1][depPath];\n            if (!workerSources[depKey]) {\n                resolveSources(depKey);\n            }\n        }\n    }\n\n    var src = '(' + bundleFn + ')({'\n        + Object.keys(workerSources).map(function (key) {\n            return stringify(key) + ':['\n                + sources[key][0]\n                + ',' + stringify(sources[key][1]) + ']'\n            ;\n        }).join(',')\n        + '},{},[' + stringify(skey) + '])'\n    ;\n\n    var URL = window.URL || window.webkitURL || window.mozURL || window.msURL;\n\n    var blob = new Blob([src], { type: 'text/javascript' });\n    if (options && options.bare) { return blob; }\n    var workerUrl = URL.createObjectURL(blob);\n    var worker = new Worker(workerUrl);\n    worker.objectURL = workerUrl;\n    return worker;\n};\n\n},{}],\"/index.js\":[function(_dereq_,module,exports){\n'use strict';\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction _iterableToArrayLimit(arr, i) { var _i = arr == null ? null : typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"]; if (_i == null) return; var _arr = []; var _n = true; var _d = false; var _s, _e; try { for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nvar assign = _dereq_('object-assign');\n\nvar webworkify = _dereq_('webworkify');\n\nvar MathLib = _dereq_('./lib/mathlib');\n\nvar Pool = _dereq_('./lib/pool');\n\nvar utils = _dereq_('./lib/utils');\n\nvar worker = _dereq_('./lib/worker');\n\nvar createStages = _dereq_('./lib/stepper');\n\nvar createRegions = _dereq_('./lib/tiler'); // Deduplicate pools & limiters with the same configs\n// when user creates multiple pica instances.\n\n\nvar singletones = {};\nvar NEED_SAFARI_FIX = false;\n\ntry {\n  if (typeof navigator !== 'undefined' && navigator.userAgent) {\n    NEED_SAFARI_FIX = navigator.userAgent.indexOf('Safari') >= 0;\n  }\n} catch (e) {}\n\nvar concurrency = 1;\n\nif (typeof navigator !== 'undefined') {\n  concurrency = Math.min(navigator.hardwareConcurrency || 1, 4);\n}\n\nvar DEFAULT_PICA_OPTS = {\n  tile: 1024,\n  concurrency: concurrency,\n  features: ['js', 'wasm', 'ww'],\n  idle: 2000,\n  createCanvas: function createCanvas(width, height) {\n    var tmpCanvas = document.createElement('canvas');\n    tmpCanvas.width = width;\n    tmpCanvas.height = height;\n    return tmpCanvas;\n  }\n};\nvar DEFAULT_RESIZE_OPTS = {\n  quality: 3,\n  alpha: false,\n  unsharpAmount: 0,\n  unsharpRadius: 0.0,\n  unsharpThreshold: 0\n};\nvar CAN_NEW_IMAGE_DATA = false;\nvar CAN_CREATE_IMAGE_BITMAP = false;\nvar CAN_USE_CANVAS_GET_IMAGE_DATA = false;\nvar CAN_USE_OFFSCREEN_CANVAS = false;\nvar CAN_USE_CIB_REGION_FOR_IMAGE = false;\n\nfunction workerFabric() {\n  return {\n    value: webworkify(worker),\n    destroy: function destroy() {\n      this.value.terminate();\n\n      if (typeof window !== 'undefined') {\n        var url = window.URL || window.webkitURL || window.mozURL || window.msURL;\n\n        if (url && url.revokeObjectURL && this.value.objectURL) {\n          url.revokeObjectURL(this.value.objectURL);\n        }\n      }\n    }\n  };\n} ////////////////////////////////////////////////////////////////////////////////\n// API methods\n\n\nfunction Pica(options) {\n  if (!(this instanceof Pica)) return new Pica(options);\n  this.options = assign({}, DEFAULT_PICA_OPTS, options || {});\n  var limiter_key = \"lk_\".concat(this.options.concurrency); // Share limiters to avoid multiple parallel workers when user creates\n  // multiple pica instances.\n\n  this.__limit = singletones[limiter_key] || utils.limiter(this.options.concurrency);\n  if (!singletones[limiter_key]) singletones[limiter_key] = this.__limit; // List of supported features, according to options & browser/node.js\n\n  this.features = {\n    js: false,\n    // pure JS implementation, can be disabled for testing\n    wasm: false,\n    // webassembly implementation for heavy functions\n    cib: false,\n    // resize via createImageBitmap (only FF at this moment)\n    ww: false // webworkers\n\n  };\n  this.__workersPool = null; // Store requested features for webworkers\n\n  this.__requested_features = [];\n  this.__mathlib = null;\n}\n\nPica.prototype.init = function () {\n  var _this = this;\n\n  if (this.__initPromise) return this.__initPromise; // Test if we can create ImageData without canvas and memory copy\n\n  if (typeof ImageData !== 'undefined' && typeof Uint8ClampedArray !== 'undefined') {\n    try {\n      /* eslint-disable no-new */\n      new ImageData(new Uint8ClampedArray(400), 10, 10);\n      CAN_NEW_IMAGE_DATA = true;\n    } catch (__) {}\n  } // ImageBitmap can be effective in 2 places:\n  //\n  // 1. Threaded jpeg unpack (basic)\n  // 2. Built-in resize (blocked due problem in chrome, see issue #89)\n  //\n  // For basic use we also need ImageBitmap wo support .close() method,\n  // see https://developer.mozilla.org/ru/docs/Web/API/ImageBitmap\n\n\n  if (typeof ImageBitmap !== 'undefined') {\n    if (ImageBitmap.prototype && ImageBitmap.prototype.close) {\n      CAN_CREATE_IMAGE_BITMAP = true;\n    } else {\n      this.debug('ImageBitmap does not support .close(), disabled');\n    }\n  }\n\n  var features = this.options.features.slice();\n\n  if (features.indexOf('all') >= 0) {\n    features = ['cib', 'wasm', 'js', 'ww'];\n  }\n\n  this.__requested_features = features;\n  this.__mathlib = new MathLib(features); // Check WebWorker support if requested\n\n  if (features.indexOf('ww') >= 0) {\n    if (typeof window !== 'undefined' && 'Worker' in window) {\n      // IE <= 11 don't allow to create webworkers from string. We should check it.\n      // https://connect.microsoft.com/IE/feedback/details/801810/web-workers-from-blob-urls-in-ie-10-and-11\n      try {\n        var wkr = _dereq_('webworkify')(function () {});\n\n        wkr.terminate();\n        this.features.ww = true; // pool uniqueness depends on pool config + webworker config\n\n        var wpool_key = \"wp_\".concat(JSON.stringify(this.options));\n\n        if (singletones[wpool_key]) {\n          this.__workersPool = singletones[wpool_key];\n        } else {\n          this.__workersPool = new Pool(workerFabric, this.options.idle);\n          singletones[wpool_key] = this.__workersPool;\n        }\n      } catch (__) {}\n    }\n  }\n\n  var initMath = this.__mathlib.init().then(function (mathlib) {\n    // Copy detected features\n    assign(_this.features, mathlib.features);\n  });\n\n  var checkCibResize;\n\n  if (!CAN_CREATE_IMAGE_BITMAP) {\n    checkCibResize = Promise.resolve(false);\n  } else {\n    checkCibResize = utils.cib_support(this.options.createCanvas).then(function (status) {\n      if (_this.features.cib && features.indexOf('cib') < 0) {\n        _this.debug('createImageBitmap() resize supported, but disabled by config');\n\n        return;\n      }\n\n      if (features.indexOf('cib') >= 0) _this.features.cib = status;\n    });\n  }\n\n  CAN_USE_CANVAS_GET_IMAGE_DATA = utils.can_use_canvas(this.options.createCanvas);\n  var checkOffscreenCanvas;\n\n  if (CAN_CREATE_IMAGE_BITMAP && CAN_NEW_IMAGE_DATA && features.indexOf('ww') !== -1) {\n    checkOffscreenCanvas = utils.worker_offscreen_canvas_support();\n  } else {\n    checkOffscreenCanvas = Promise.resolve(false);\n  }\n\n  checkOffscreenCanvas = checkOffscreenCanvas.then(function (result) {\n    CAN_USE_OFFSCREEN_CANVAS = result;\n  }); // we use createImageBitmap to crop image data and pass it to workers,\n  // so need to check whether function works correctly;\n  // https://bugs.chromium.org/p/chromium/issues/detail?id=1220671\n\n  var checkCibRegion = utils.cib_can_use_region().then(function (result) {\n    CAN_USE_CIB_REGION_FOR_IMAGE = result;\n  }); // Init math lib. That's async because can load some\n\n  this.__initPromise = Promise.all([initMath, checkCibResize, checkOffscreenCanvas, checkCibRegion]).then(function () {\n    return _this;\n  });\n  return this.__initPromise;\n}; // Call resizer in webworker or locally, depending on config\n\n\nPica.prototype.__invokeResize = function (tileOpts, opts) {\n  var _this2 = this;\n\n  // Share cache between calls:\n  //\n  // - wasm instance\n  // - wasm memory object\n  //\n  opts.__mathCache = opts.__mathCache || {};\n  return Promise.resolve().then(function () {\n    if (!_this2.features.ww) {\n      // not possible to have ImageBitmap here if user disabled WW\n      return {\n        data: _this2.__mathlib.resizeAndUnsharp(tileOpts, opts.__mathCache)\n      };\n    }\n\n    return new Promise(function (resolve, reject) {\n      var w = _this2.__workersPool.acquire();\n\n      if (opts.cancelToken) opts.cancelToken[\"catch\"](function (err) {\n        return reject(err);\n      });\n\n      w.value.onmessage = function (ev) {\n        w.release();\n        if (ev.data.err) reject(ev.data.err);else resolve(ev.data);\n      };\n\n      var transfer = [];\n      if (tileOpts.src) transfer.push(tileOpts.src.buffer);\n      if (tileOpts.srcBitmap) transfer.push(tileOpts.srcBitmap);\n      w.value.postMessage({\n        opts: tileOpts,\n        features: _this2.__requested_features,\n        preload: {\n          wasm_nodule: _this2.__mathlib.__\n        }\n      }, transfer);\n    });\n  });\n}; // this function can return promise if createImageBitmap is used\n\n\nPica.prototype.__extractTileData = function (tile, from, opts, stageEnv, extractTo) {\n  if (this.features.ww && CAN_USE_OFFSCREEN_CANVAS && ( // createImageBitmap doesn't work for images (Image, ImageBitmap) with Exif orientation in Chrome,\n  // can use canvas because canvas doesn't have orientation;\n  // see https://bugs.chromium.org/p/chromium/issues/detail?id=1220671\n  utils.isCanvas(from) || CAN_USE_CIB_REGION_FOR_IMAGE)) {\n    this.debug('Create tile for OffscreenCanvas');\n    return createImageBitmap(stageEnv.srcImageBitmap || from, tile.x, tile.y, tile.width, tile.height).then(function (bitmap) {\n      extractTo.srcBitmap = bitmap;\n      return extractTo;\n    });\n  } // Extract tile RGBA buffer, depending on input type\n\n\n  if (utils.isCanvas(from)) {\n    if (!stageEnv.srcCtx) stageEnv.srcCtx = from.getContext('2d', {\n      alpha: Boolean(opts.alpha)\n    }); // If input is Canvas - extract region data directly\n\n    this.debug('Get tile pixel data');\n    extractTo.src = stageEnv.srcCtx.getImageData(tile.x, tile.y, tile.width, tile.height).data;\n    return extractTo;\n  } // If input is Image or decoded to ImageBitmap,\n  // draw region to temporary canvas and extract data from it\n  //\n  // Note! Attempt to reuse this canvas causes significant slowdown in chrome\n  //\n\n\n  this.debug('Draw tile imageBitmap/image to temporary canvas');\n  var tmpCanvas = this.options.createCanvas(tile.width, tile.height);\n  var tmpCtx = tmpCanvas.getContext('2d', {\n    alpha: Boolean(opts.alpha)\n  });\n  tmpCtx.globalCompositeOperation = 'copy';\n  tmpCtx.drawImage(stageEnv.srcImageBitmap || from, tile.x, tile.y, tile.width, tile.height, 0, 0, tile.width, tile.height);\n  this.debug('Get tile pixel data');\n  extractTo.src = tmpCtx.getImageData(0, 0, tile.width, tile.height).data; // Safari 12 workaround\n  // https://github.com/nodeca/pica/issues/199\n\n  tmpCanvas.width = tmpCanvas.height = 0;\n  return extractTo;\n};\n\nPica.prototype.__landTileData = function (tile, result, stageEnv) {\n  var toImageData;\n  this.debug('Convert raw rgba tile result to ImageData');\n\n  if (result.bitmap) {\n    stageEnv.toCtx.drawImage(result.bitmap, tile.toX, tile.toY);\n    return null;\n  }\n\n  if (CAN_NEW_IMAGE_DATA) {\n    // this branch is for modern browsers\n    // If `new ImageData()` & Uint8ClampedArray suported\n    toImageData = new ImageData(new Uint8ClampedArray(result.data), tile.toWidth, tile.toHeight);\n  } else {\n    // fallback for `node-canvas` and old browsers\n    // (IE11 has ImageData but does not support `new ImageData()`)\n    toImageData = stageEnv.toCtx.createImageData(tile.toWidth, tile.toHeight);\n\n    if (toImageData.data.set) {\n      toImageData.data.set(result.data);\n    } else {\n      // IE9 don't have `.set()`\n      for (var i = toImageData.data.length - 1; i >= 0; i--) {\n        toImageData.data[i] = result.data[i];\n      }\n    }\n  }\n\n  this.debug('Draw tile');\n\n  if (NEED_SAFARI_FIX) {\n    // Safari draws thin white stripes between tiles without this fix\n    stageEnv.toCtx.putImageData(toImageData, tile.toX, tile.toY, tile.toInnerX - tile.toX, tile.toInnerY - tile.toY, tile.toInnerWidth + 1e-5, tile.toInnerHeight + 1e-5);\n  } else {\n    stageEnv.toCtx.putImageData(toImageData, tile.toX, tile.toY, tile.toInnerX - tile.toX, tile.toInnerY - tile.toY, tile.toInnerWidth, tile.toInnerHeight);\n  }\n\n  return null;\n};\n\nPica.prototype.__tileAndResize = function (from, to, opts) {\n  var _this3 = this;\n\n  var stageEnv = {\n    srcCtx: null,\n    srcImageBitmap: null,\n    isImageBitmapReused: false,\n    toCtx: null\n  };\n\n  var processTile = function processTile(tile) {\n    return _this3.__limit(function () {\n      if (opts.canceled) return opts.cancelToken;\n      var tileOpts = {\n        width: tile.width,\n        height: tile.height,\n        toWidth: tile.toWidth,\n        toHeight: tile.toHeight,\n        scaleX: tile.scaleX,\n        scaleY: tile.scaleY,\n        offsetX: tile.offsetX,\n        offsetY: tile.offsetY,\n        quality: opts.quality,\n        alpha: opts.alpha,\n        unsharpAmount: opts.unsharpAmount,\n        unsharpRadius: opts.unsharpRadius,\n        unsharpThreshold: opts.unsharpThreshold\n      };\n\n      _this3.debug('Invoke resize math');\n\n      return Promise.resolve(tileOpts).then(function (tileOpts) {\n        return _this3.__extractTileData(tile, from, opts, stageEnv, tileOpts);\n      }).then(function (tileOpts) {\n        _this3.debug('Invoke resize math');\n\n        return _this3.__invokeResize(tileOpts, opts);\n      }).then(function (result) {\n        if (opts.canceled) return opts.cancelToken;\n        stageEnv.srcImageData = null;\n        return _this3.__landTileData(tile, result, stageEnv);\n      });\n    });\n  }; // Need to normalize data source first. It can be canvas or image.\n  // If image - try to decode in background if possible\n\n\n  return Promise.resolve().then(function () {\n    stageEnv.toCtx = to.getContext('2d', {\n      alpha: Boolean(opts.alpha)\n    });\n    if (utils.isCanvas(from)) return null;\n\n    if (utils.isImageBitmap(from)) {\n      stageEnv.srcImageBitmap = from;\n      stageEnv.isImageBitmapReused = true;\n      return null;\n    }\n\n    if (utils.isImage(from)) {\n      // try do decode image in background for faster next operations;\n      // if we're using offscreen canvas, cib is called per tile, so not needed here\n      if (!CAN_CREATE_IMAGE_BITMAP) return null;\n\n      _this3.debug('Decode image via createImageBitmap');\n\n      return createImageBitmap(from).then(function (imageBitmap) {\n        stageEnv.srcImageBitmap = imageBitmap;\n      }) // Suppress error to use fallback, if method fails\n      // https://github.com/nodeca/pica/issues/190\n\n      /* eslint-disable no-unused-vars */\n      [\"catch\"](function (e) {\n        return null;\n      });\n    }\n\n    throw new Error('Pica: \".from\" should be Image, Canvas or ImageBitmap');\n  }).then(function () {\n    if (opts.canceled) return opts.cancelToken;\n\n    _this3.debug('Calculate tiles'); //\n    // Here we are with \"normalized\" source,\n    // follow to tiling\n    //\n\n\n    var regions = createRegions({\n      width: opts.width,\n      height: opts.height,\n      srcTileSize: _this3.options.tile,\n      toWidth: opts.toWidth,\n      toHeight: opts.toHeight,\n      destTileBorder: opts.__destTileBorder\n    });\n    var jobs = regions.map(function (tile) {\n      return processTile(tile);\n    });\n\n    function cleanup(stageEnv) {\n      if (stageEnv.srcImageBitmap) {\n        if (!stageEnv.isImageBitmapReused) stageEnv.srcImageBitmap.close();\n        stageEnv.srcImageBitmap = null;\n      }\n    }\n\n    _this3.debug('Process tiles');\n\n    return Promise.all(jobs).then(function () {\n      _this3.debug('Finished!');\n\n      cleanup(stageEnv);\n      return to;\n    }, function (err) {\n      cleanup(stageEnv);\n      throw err;\n    });\n  });\n};\n\nPica.prototype.__processStages = function (stages, from, to, opts) {\n  var _this4 = this;\n\n  if (opts.canceled) return opts.cancelToken;\n\n  var _stages$shift = stages.shift(),\n      _stages$shift2 = _slicedToArray(_stages$shift, 2),\n      toWidth = _stages$shift2[0],\n      toHeight = _stages$shift2[1];\n\n  var isLastStage = stages.length === 0;\n  opts = assign({}, opts, {\n    toWidth: toWidth,\n    toHeight: toHeight,\n    // only use user-defined quality for the last stage,\n    // use simpler (Hamming) filter for the first stages where\n    // scale factor is large enough (more than 2-3)\n    quality: isLastStage ? opts.quality : Math.min(1, opts.quality)\n  });\n  var tmpCanvas;\n\n  if (!isLastStage) {\n    // create temporary canvas\n    tmpCanvas = this.options.createCanvas(toWidth, toHeight);\n  }\n\n  return this.__tileAndResize(from, isLastStage ? to : tmpCanvas, opts).then(function () {\n    if (isLastStage) return to;\n    opts.width = toWidth;\n    opts.height = toHeight;\n    return _this4.__processStages(stages, tmpCanvas, to, opts);\n  }).then(function (res) {\n    if (tmpCanvas) {\n      // Safari 12 workaround\n      // https://github.com/nodeca/pica/issues/199\n      tmpCanvas.width = tmpCanvas.height = 0;\n    }\n\n    return res;\n  });\n};\n\nPica.prototype.__resizeViaCreateImageBitmap = function (from, to, opts) {\n  var _this5 = this;\n\n  var toCtx = to.getContext('2d', {\n    alpha: Boolean(opts.alpha)\n  });\n  this.debug('Resize via createImageBitmap()');\n  return createImageBitmap(from, {\n    resizeWidth: opts.toWidth,\n    resizeHeight: opts.toHeight,\n    resizeQuality: utils.cib_quality_name(opts.quality)\n  }).then(function (imageBitmap) {\n    if (opts.canceled) return opts.cancelToken; // if no unsharp - draw directly to output canvas\n\n    if (!opts.unsharpAmount) {\n      toCtx.drawImage(imageBitmap, 0, 0);\n      imageBitmap.close();\n      toCtx = null;\n\n      _this5.debug('Finished!');\n\n      return to;\n    }\n\n    _this5.debug('Unsharp result');\n\n    var tmpCanvas = _this5.options.createCanvas(opts.toWidth, opts.toHeight);\n\n    var tmpCtx = tmpCanvas.getContext('2d', {\n      alpha: Boolean(opts.alpha)\n    });\n    tmpCtx.drawImage(imageBitmap, 0, 0);\n    imageBitmap.close();\n    var iData = tmpCtx.getImageData(0, 0, opts.toWidth, opts.toHeight);\n\n    _this5.__mathlib.unsharp_mask(iData.data, opts.toWidth, opts.toHeight, opts.unsharpAmount, opts.unsharpRadius, opts.unsharpThreshold);\n\n    toCtx.putImageData(iData, 0, 0); // Safari 12 workaround\n    // https://github.com/nodeca/pica/issues/199\n\n    tmpCanvas.width = tmpCanvas.height = 0;\n    iData = tmpCtx = tmpCanvas = toCtx = null;\n\n    _this5.debug('Finished!');\n\n    return to;\n  });\n};\n\nPica.prototype.resize = function (from, to, options) {\n  var _this6 = this;\n\n  this.debug('Start resize...');\n  var opts = assign({}, DEFAULT_RESIZE_OPTS);\n\n  if (!isNaN(options)) {\n    opts = assign(opts, {\n      quality: options\n    });\n  } else if (options) {\n    opts = assign(opts, options);\n  }\n\n  opts.toWidth = to.width;\n  opts.toHeight = to.height;\n  opts.width = from.naturalWidth || from.width;\n  opts.height = from.naturalHeight || from.height; // Prevent stepper from infinite loop\n\n  if (to.width === 0 || to.height === 0) {\n    return Promise.reject(new Error(\"Invalid output size: \".concat(to.width, \"x\").concat(to.height)));\n  }\n\n  if (opts.unsharpRadius > 2) opts.unsharpRadius = 2;\n  opts.canceled = false;\n\n  if (opts.cancelToken) {\n    // Wrap cancelToken to avoid successive resolve & set flag\n    opts.cancelToken = opts.cancelToken.then(function (data) {\n      opts.canceled = true;\n      throw data;\n    }, function (err) {\n      opts.canceled = true;\n      throw err;\n    });\n  }\n\n  var DEST_TILE_BORDER = 3; // Max possible filter window size\n\n  opts.__destTileBorder = Math.ceil(Math.max(DEST_TILE_BORDER, 2.5 * opts.unsharpRadius | 0));\n  return this.init().then(function () {\n    if (opts.canceled) return opts.cancelToken; // if createImageBitmap supports resize, just do it and return\n\n    if (_this6.features.cib) {\n      return _this6.__resizeViaCreateImageBitmap(from, to, opts);\n    }\n\n    if (!CAN_USE_CANVAS_GET_IMAGE_DATA) {\n      var err = new Error('Pica: cannot use getImageData on canvas, ' + \"make sure fingerprinting protection isn't enabled\");\n      err.code = 'ERR_GET_IMAGE_DATA';\n      throw err;\n    } //\n    // No easy way, let's resize manually via arrays\n    //\n\n\n    var stages = createStages(opts.width, opts.height, opts.toWidth, opts.toHeight, _this6.options.tile, opts.__destTileBorder);\n    return _this6.__processStages(stages, from, to, opts);\n  });\n}; // RGBA buffer resize\n//\n\n\nPica.prototype.resizeBuffer = function (options) {\n  var _this7 = this;\n\n  var opts = assign({}, DEFAULT_RESIZE_OPTS, options);\n  return this.init().then(function () {\n    return _this7.__mathlib.resizeAndUnsharp(opts);\n  });\n};\n\nPica.prototype.toBlob = function (canvas, mimeType, quality) {\n  mimeType = mimeType || 'image/png';\n  return new Promise(function (resolve) {\n    if (canvas.toBlob) {\n      canvas.toBlob(function (blob) {\n        return resolve(blob);\n      }, mimeType, quality);\n      return;\n    }\n\n    if (canvas.convertToBlob) {\n      resolve(canvas.convertToBlob({\n        type: mimeType,\n        quality: quality\n      }));\n      return;\n    } // Fallback for old browsers\n\n\n    var asString = atob(canvas.toDataURL(mimeType, quality).split(',')[1]);\n    var len = asString.length;\n    var asBuffer = new Uint8Array(len);\n\n    for (var i = 0; i < len; i++) {\n      asBuffer[i] = asString.charCodeAt(i);\n    }\n\n    resolve(new Blob([asBuffer], {\n      type: mimeType\n    }));\n  });\n};\n\nPica.prototype.debug = function () {};\n\nmodule.exports = Pica;\n\n},{\"./lib/mathlib\":1,\"./lib/pool\":13,\"./lib/stepper\":14,\"./lib/tiler\":15,\"./lib/utils\":16,\"./lib/worker\":17,\"object-assign\":23,\"webworkify\":24}]},{},[])(\"/index.js\")\n});\n"]},"metadata":{},"sourceType":"script"}